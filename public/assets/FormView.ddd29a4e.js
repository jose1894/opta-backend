import{q as ge,ag as be,ah as fe,at as Ve,aa as $e,y as d,aK as W,au as je,I as Se,o as _e,c as Ye,w as n,j as w,a as t,d as X,B as u,u as i,C as c,av as Z,aw as x,ax as b,z as we,g as Me}from"./index.e27aaed2.js";import{r as ye,m as Ne,u as De}from"./index.esm.6263d8b1.js";import{p as T}from"./projects.service.f058dcd0.js";import{b as Ue}from"./bussinesUnit.service.20bca8ab.js";import{c as Le}from"./clients.srvice.5f8d7b0a.js";import{p as ee}from"./personal.service.ad7206b3.js";import{b as he}from"./branches.service.3487c96a.js";import{a as Be}from"./activities.service.76eab6f5.js";const Ce={class:"grid md:grid-cols-3 gap-4"},Fe={class:"grid md:grid-cols-3 gap-3"},Te={class:"grid md:grid-cols-1 gap-1"},ke={style:{display:"flex","justify-content":"space-between"}},Ie={__name:"FormView",props:{path:"",saveLabel:"",project:{}},setup(ae){const j=ae,{t:f}=be(),k=fe(),oe=Ve(),I=$e(),O=d(!0);let M=d([]),y=d([]),N=d([]),D=d([]),U=d([]),L=d([]);const h=[{id:1,label:f("message.project.statuses.active")},{id:0,label:f("message.project.statuses.inactive")}];d({date:"DD-MM-YYYY",month:"MMM"});const R=d("");d("");const e=d({_id:"",codigo:"0000000",fecha:W(new Date,"DD-MM-YYYY").format("DD-MM-YYYY"),creado:"",cliente:y.value,socio:N.value,gerente:D.value,sucursal:U.value,unidadNegocio:M.value,tipoServicio:L.value,descripcionServicio:"",creadoName:"",estado:h[0]}),se=o=>{const{_id:a,codigo:r,fecha:p,creado:m,cliente:g,socio:v,gerente:$,sucursal:l,unidadNegocio:C,tipoServicio:S,descripcionServicio:F,estado:_}=o.value,Y={_id:a,codigo:r,fecha:p,creado:m,cliente:g.id,socio:v.id,gerente:$.id,sucursal:l.id,unidadNegocio:C.id,tipoServicio:S.id,descripcionServicio:F,estado:_.id};return j.path==="create"?T.create(Y):T.update(Y)};je(async()=>{var P,q,A,G,z,J,K,E,H,Q;let o=await Le.allClientes();const a=o==null?void 0:o.data.cliente;y.value=a.map(s=>({id:s._id,label:s.nombre}));let r=await ee.getListTipoPersonal(1);const p=r==null?void 0:r.data.personas;N.value=p.map(s=>({id:s._id,label:s.nombres}));let m=await ee.getListTipoPersonal(2);const g=m==null?void 0:m.data.personas;D.value=g.map(s=>({id:s._id,label:s.nombres}));let v=await he.sucursalesGet();const $=v==null?void 0:v.data.sucursales;U.value=$.map(s=>({id:s._id,label:s.nombre}));let l=await Be.allActividades();const C=l==null?void 0:l.data.actividades;L.value=C.map(s=>({id:s._id,label:s.nombre}));let S=await Ue.allBussinesUnitGet();const F=S==null?void 0:S.data.unidadesNegocio;M.value=F.map(s=>({id:s._id,label:s.nombre}));const _=JSON.parse(localStorage.getItem("user")),{firstname:Y,lastname:de,id:ue}=(P=_.userData)!=null?P:{};if(e.value.creadoName=`${Y} ${de}`,e.value.creado=ue,console.log(_.userData),j.path==="update"){const s=await T.read(oe.params);e.value=s.data;const{firstname:ce,lastname:me,_id:pe}=(A=(q=s.data)==null?void 0:q.creado)!=null?A:{};e.value.creadoName=`${ce} ${me}`,e.value.creado=pe,R.value=new Date((G=s.data)==null?void 0:G.fecha),e.value.fecha=W(R.value,"DD-MM-YYYY").format("DD-MM-YYYY"),e.value.cliente=V((z=s.data)==null?void 0:z.cliente),e.value.socio=V((J=s.data)==null?void 0:J.socio),e.value.gerente=V((K=s.data)==null?void 0:K.gerente),e.value.sucursal=V((E=s.data)==null?void 0:E.sucursal),e.value.unidadNegocio=V((H=s.data)==null?void 0:H.unidadNegocio),e.value.tipoServicio=V((Q=s.data)==null?void 0:Q.tipoServicio),e.value.estado=h.filter(ve=>ve.id===s.data.estado)[0]}});const V=o=>({id:o._id,label:(o==null?void 0:o.nombre)||(o==null?void 0:o.descripcion)||(o==null?void 0:o.nombres)}),le=Se(()=>({codigo:{required:ye,maxLength:Ne(10)}})),B=De(le,e),te=j.path==="create"?f("message.project.created.success"):f("message.project.updated.success"),ie=j.path==="create"?f("message.project.created.error"):f("message.project.updated.error"),ne=async()=>{await B.value.$validate()?se(e).then(()=>{k.success(te),I.push("/setup/projects")}).catch(a=>{var r,p;if((r=a.response.data)!=null&&r.msg){k.error(`${ie} ${a.response.data.msg}`);return}if((p=a.response.data)!=null&&p.errors){const m=a.response.data.errors;for(let g of m);}}):console.log("error")},re=()=>I.push("/setup/projects");return(o,a)=>(_e(),Ye(Me,{isForm:"",onSubmit:we(ne,["prevent"])},{footer:n(()=>[w("div",ke,[t(X,{label:o.$t(`message.${j.saveLabel}`),type:"submit",color:"success"},null,8,["label"]),t(X,{label:o.$t("message.return"),color:"info",onClick:a[11]||(a[11]=r=>re())},null,8,["label"])])]),default:n(()=>{var r,p,m,g,v,$;return[w("div",Ce,[t(u,{label:o.$t("message.project.code"),help:(m=(p=(r=i(B))==null?void 0:r.codigo)==null?void 0:p.$errors[0])==null?void 0:m.$message},{default:n(()=>[t(c,{name:"codigo",modelValue:e.value.codigo,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.codigo=l),icon:i(Z)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),t(u,{label:o.$t("message.project.date")},{default:n(()=>[t(c,{name:"fecha",modelValue:e.value.fecha,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.fecha=l),icon:i(Z),readonly:O.value},null,8,["modelValue","icon","readonly"])]),_:1},8,["label"]),t(u,{label:o.$t("message.project.createdProject"),class:"c_hidden"},{default:n(()=>[t(c,{modelValue:e.value.creadoName,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.creadoName=l),icon:i(x),readonly:O.value},null,8,["modelValue","icon","readonly"])]),_:1},8,["label"]),t(u,{label:o.$t("message.project.client")},{default:n(()=>[t(c,{modelValue:e.value.cliente,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.cliente=l),icon:i(b),options:i(y)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),t(u,{label:o.$t("message.project.partner")},{default:n(()=>[t(c,{modelValue:e.value.socio,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.socio=l),icon:i(b),options:i(N)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),t(u,{label:o.$t("message.project.manager")},{default:n(()=>[t(c,{modelValue:e.value.gerente,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.gerente=l),icon:i(b),options:i(D)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),t(u,{label:o.$t("message.project.branch")},{default:n(()=>[t(c,{modelValue:e.value.sucursal,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.sucursal=l),icon:i(b),options:i(U)},null,8,["modelValue","icon","options"])]),_:1},8,["label"])]),w("div",Fe,[t(u,{label:o.$t("message.project.bussinesUnit")},{default:n(()=>[t(c,{modelValue:e.value.unidadNegocio,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.unidadNegocio=l),icon:i(b),options:i(M)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),t(u,{label:o.$t("message.project.typeOfService")},{default:n(()=>[t(c,{modelValue:e.value.tipoServicio,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.tipoServicio=l),icon:i(b),options:i(L)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),t(u,{label:o.$t("message.project.status"),help:($=(v=(g=i(B))==null?void 0:g.estado)==null?void 0:v.$errors[0])==null?void 0:$.$message},{default:n(()=>[t(c,{modelValue:e.value.estado,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.estado=l),icon:i(b),options:h},null,8,["modelValue","icon"])]),_:1},8,["label","help"])]),w("div",Te,[t(u,{label:o.$t("message.project.serviceDescription")},{default:n(()=>[t(c,{type:"textarea",modelValue:e.value.descripcionServicio,"onUpdate:modelValue":a[10]||(a[10]=l=>e.value.descripcionServicio=l),icon:i(x)},null,8,["modelValue","icon"])]),_:1},8,["label"])])]}),_:1},8,["onSubmit"]))}},Ke=ge(Ie,[["__scopeId","data-v-dc84c419"]]);export{Ke as F};
