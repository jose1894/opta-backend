import{ag as Z,ah as ee,at as se,aa as ae,x as oe,y as _,I as j,au as te,o as L,c as R,w as r,j as v,a as l,d as E,B as g,u as i,C as V,av as le,aw as ie,ax as N,r as ne,K as re,L as ce,z as de,g as ue}from"./index.e27aaed2.js";import{r as M,m as me,u as pe}from"./index.esm.6263d8b1.js";import{p as P}from"./profiles.service.8ec61cb8.js";import{i as fe}from"./itemsMenu.service.6fcbd694.js";import{_ as ge}from"./FormCheckRadioGroup.84cb26fc.js";import{p as ve}from"./profileActions.service.e8621814.js";const be={class:"grid md:grid-cols-2 gap-2"},he=v("div",{class:"grid md:grid-cols-1"},[v("h4",{class:"text-xl"},"Acciones del perfil")],-1),$e={class:"grid md:grid-cols-2 gap-2"},_e={style:{display:"flex","justify-content":"space-between"}},Me={__name:"FormView",props:{path:"",saveLabel:""},setup(O){const m=O,{t:c}=Z(),C=ee(),T=se(),B=ae();let d=[];const b=oe({checkbox:[]}),x=[{id:1,label:c("message.profiles.statuses.active")},{id:0,label:c("message.profiles.statuses.inactive")}];let k=_([]),y=_([]),q=_([]);const w=j(()=>y.value),t=_({_id:"",codigo:"00",descripcion:"",menu:k.value,accionesPerfil:q.value,estado:x[0]}),z=s=>{const{_id:e,codigo:a,descripcion:o,menu:u,accionesPerfil:p,estado:$}=s.value,f={_id:e,codigo:a,descripcion:o,menu:u.id,accionesPerfil:p,estado:$.id};return m.path==="create"?P.create(f):P.update(f)};te(async()=>{var s;if(D(),K(),m.path==="update"){const e=await P.read(T.params);t.value=e.data,t.value.estado=x.filter(o=>o.id===e.data.estado)[0];const a=(s=e.data)==null?void 0:s.accionesPerfil;d=a.map(o=>({_id:o._id})),b.checkbox=a.map(o=>o._id),console.log(b)}});const D=async()=>{let s=await fe.allMenu();const e=s==null?void 0:s.data.menu;k.value=e.map(a=>({id:a._id,label:a.descripcion}))},K=async()=>{let s=await ve.allAccionesPerfiles();const e=s==null?void 0:s.data.accionesPerfiles;console.log(e),y.value=G(e),console.log(y)},G=s=>s.map(({_id:e,descripcion:a})=>({[e]:a})),H=j(()=>({codigo:{required:M,maxLength:me(3)},descripcion:{required:M},estado:{required:M}})),h=pe(H,t),J=m.path==="create"?c("message.profiles.created.success"):c("message.profiles.updated.success"),Q=m.path==="create"?c("message.profiles.created.error"):c("message.profiles.updated.error"),W=async()=>{await h.value.$validate()?z(t).then(()=>{C.success(J),B.push("/setup/profiles")}).catch(e=>{var a,o;if((a=e.response.data)!=null&&a.msg){C.error(`${Q} ${e.response.data.msg}`);return}if((o=e.response.data)!=null&&o.errors){const u=e.response.data.errors;for(let p of u);}}):console.log("error")},X=s=>{const e=Object.keys(s)[0];d.filter(o=>o._id===e).length===0?d.push({_id:e}):d=d.filter(o=>o._id!==e),t.value.accionesPerfil=d,console.log(t.value)},Y=()=>B.push("/setup/profiles");return(s,e)=>(L(),R(ue,{isForm:"",onSubmit:de(W,["prevent"])},{footer:r(()=>[v("div",_e,[l(E,{label:s.$t(`message.${m.saveLabel}`),type:"submit",color:"success"},null,8,["label"]),l(E,{label:s.$t("message.return"),color:"info",onClick:e[5]||(e[5]=a=>Y())},null,8,["label"])])]),default:r(()=>{var a,o,u,p,$,f,A,S,U;return[v("div",be,[l(g,{label:s.$t("message.profiles.code"),help:(u=(o=(a=i(h))==null?void 0:a.codigo)==null?void 0:o.$errors[0])==null?void 0:u.$message},{default:r(()=>[l(V,{name:"codigo",modelValue:t.value.codigo,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.codigo=n),icon:i(le)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),l(g,{label:s.$t("message.profiles.description"),help:(f=($=(p=i(h))==null?void 0:p.descripcion)==null?void 0:$.$errors[0])==null?void 0:f.$message},{default:r(()=>[l(V,{modelValue:t.value.descripcion,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.descripcion=n),icon:i(ie)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),l(g,{label:s.$t("message.profiles.menu")},{default:r(()=>[l(V,{modelValue:t.value.menu,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.menu=n),icon:i(N),options:i(k)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),l(g,{label:s.$t("message.profiles.status"),help:(U=(S=(A=i(h))==null?void 0:A.estado)==null?void 0:S.$errors[0])==null?void 0:U.$message},{default:r(()=>[l(V,{modelValue:t.value.estado,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.estado=n),icon:i(N),options:x},null,8,["modelValue","icon"])]),_:1},8,["label","help"])]),he,v("div",$e,[(L(!0),ne(re,null,ce(i(w),(n,F)=>(L(),R(g,{label:""},{default:r(()=>[l(ge,{modelValue:b.checkbox,"onUpdate:modelValue":e[4]||(e[4]=I=>b.checkbox=I),name:"sample-checkbox",options:i(w)[F],onChange:I=>X(i(w)[F])},null,8,["modelValue","options","onChange"])]),_:2},1024))),256))])]}),_:1},8,["onSubmit"]))}};export{Me as _};
