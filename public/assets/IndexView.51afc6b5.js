import{af as me,ag as pe,y as v,x as be,at as ve,o as fe,r as ge,a as o,w as d,Z as O,_ as he,J as Ve,j as V,f as L,E as T,g as $e,z as Ne,d as I,B as p,C as b,u,i as ye,b as Pe,aL as _e,au as k,aw as $,ap as A,aJ as we}from"./index.2b059d96.js";import{m as Me}from"./member.service.931fb429.js";import{e as N}from"./enfoques.service.8fe0127f.js";const Ie={class:"grid md:grid-cols-2 gap-2"},Ce={class:"container mx-auto"},Se={class:"grid md:grid-cols-4 gap-4 flex items-center"},Ye={__name:"IndexView",props:{path:"",saveLabel:"",state:{}},setup(F){const y=F,{t}=me(),g=pe();let C=v([]);const z=v(!0),h=v(!1),G=!1,m=v({}),S=v(!1);let U="";const f=[{id:0,label:t("message.no")},{id:1,label:t("message.yes")}],q=[{id:0,label:t("message.list")},{id:1,label:t("message.menu")}],D=[{id:1,label:t("message.approach.statuses.active")},{id:0,label:t("message.approach.statuses.inactive")},{id:2,label:t("message.approach.statuses.deleted")}],Y={_id:"",indice:0,nombre:"",areaPadreNombre:"",rutaPadre:"",areaPadre:"",ruta:"",visible:q[0],rcr:f[0],editable:f[0],estado:D[0],miembro:C.value,tipoNodo:2},s=v(Y),J=be({selectedNodeId:null}),P=v(),B=(e,a=[])=>{e.map(l=>{const r=a.filter(n=>(n==null?void 0:n.areaPadre)===l._id);return r.length>0&&(l.children=r,B(r,a)),l})};ve(async()=>{let e=await Me.allMiembrosGet();const a=e==null?void 0:e.data.miembros;C.value=a.map(l=>({id:l._id,label:l.nombre})),R(),y.path==="update"&&console.log(y.path)});const R=async()=>{let e=await N.index();const{enfoques:a}=e,l=a.filter(n=>n.tipoNodo===0),r=a.filter(n=>n.tipoNodo!==0);B(l,r),P.value=l},Z=y.path==="create"?t("message.approach.created.success"):t("message.approach.updated.success");y.path==="create"?t("message.approach.created.error"):t("message.approach.updated.error");const H=async()=>{K(s).then(()=>{const e=m.value;E(e),h.value=!1,s.value=Y,g.success(Z)}).catch(e=>{var a,l,r,n;if(console.log(e),(l=(a=e.response)==null?void 0:a.data)!=null&&l.msg){g.error(`${t("message.approach.created.error")} ${e.response.data.msg}`);return}if((n=(r=e.response)==null?void 0:r.data)!=null&&n.errors){const i=e.response.data.errors;for(let w of i);}})},K=async e=>{e.value.tipoNodo=e.value.rutaPadre==="/"?1:2;const{_id:a,indice:l,nombre:r,areaPadre:n,areaPadreNombre:i,rutaPadre:w,ruta:j,visible:c,rcr:re,editable:ne,estado:de,tipoNodo:ie,miembro:ue}=e.value,M={_id:a,indice:l,nombre:r,areaPadre:n,areaPadreNombre:i,rutaPadre:w,ruta:j,visible:c.id,rcr:re.id,editable:ne.id,estado:de.id,tipoNodo:ie,miembro:ue.id};if(U==="create"){const ce=we(M.fecha,"YYYY-MM-DD").format("YYYY-MM-DD");return M.fecha=ce,N.create(M)}return N.update(M)},Q=t("message.approach.selectedNode"),W=()=>{s.value=Y,U="create",Object.keys(m.value).length===0?g.error(Q):h.value=!0},X=async()=>{U="update",s.value=m.value;const{visible:e,estado:a,rcr:l,editable:r,miembro:n,areaPadre:i,areaPadreNombre:w,rutaPadre:j}=m.value;i&&(s.value.areaPadre=typeof i=="object"?i._id:i,s.value.areaPadreNombre=typeof i=="object"?i.nombre:w,s.value.rutaPadre=typeof i=="object"?i.ruta:j),s.value.estado=D.filter(c=>c.id===_(a))[0],s.value.visible=q.filter(c=>c.id===_(e))[0],s.value.rcr=f.filter(c=>c.id===_(l))[0],s.value.editable=f.filter(c=>c.id===_(r))[0],s.value.miembro=x(n),h.value=!0},_=e=>typeof e=="object"?e.id:e,x=e=>({id:(e==null?void 0:e._id)||e.id,label:(e==null?void 0:e.nombre)||(e==null?void 0:e.label)}),E=async e=>{var r;e.children=[];const a=await N.getChildren(e._id),l=((r=a==null?void 0:a.data)==null?void 0:r.children)||[];e.children=l},ee=e=>{m.value=e,s.value.areaPadre=e._id,s.value.areaPadreNombre=e.nombre,s.value.rutaPadre=e.ruta},ae=e=>{E(e),ee(e)},le=()=>{const{nombre:e}=m.value;return e},se=t("message.approach.deleted.success"),oe=async()=>{te().then(async()=>{console.log(P.value);const e=P.value;m.value.areaPadre,e.map(a=>{console.log(a)}),g.success(se)}).catch(e=>{var a;g.error(`${t("message.approach.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},te=()=>{const{_id:e}=m.value;return N.delete(e)};return(e,a)=>(fe(),ge(Ve,null,[o(O,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=l=>S.value=l),title:"Please confirm",button:"danger",onConfirm:oe,"has-cancel":""},{default:d(()=>[V("strong",null,[L(T(e.$t("message.approach.deleted.question"))+" ",1),V("b",null,T(le()),1)]),L(" ? ")]),_:1},8,["modelValue"]),o(O,{modelValue:h.value,"onUpdate:modelValue":a[9]||(a[9]=l=>h.value=l),title:"Crear enfoque",hasDone:G,claseModal:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-8/12 xl:w-8/12 z-50"},{default:d(()=>[o($e,{isForm:"",onSubmit:Ne(H,["prevent"]),style:{height:"500px","overflow-y":"scroll","scroll-behavior":"smooth"}},{footer:d(()=>[o(I,{label:e.$t("message.submit"),type:"submit",color:"success"},null,8,["label"])]),default:d(()=>[V("div",Ie,[o(p,{label:e.$t("message.approach.indice")},{default:d(()=>[o(b,{name:"indice",modelValue:s.value.indice,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value.indice=l),icon:u(k)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(p,{label:e.$t("message.approach.name")},{default:d(()=>[o(b,{name:"name",modelValue:s.value.nombre,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.nombre=l),icon:u(k)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(p,{label:e.$t("message.approach.parentArea")},{default:d(()=>[o(b,{name:"parentArea",modelValue:s.value.areaPadreNombre,"onUpdate:modelValue":a[3]||(a[3]=l=>s.value.areaPadreNombre=l),icon:u(k),readonly:!0},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(p,{label:e.$t("message.approach.visible")},{default:d(()=>[o(b,{modelValue:s.value.visible,"onUpdate:modelValue":a[4]||(a[4]=l=>s.value.visible=l),icon:u($),options:q},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(p,{label:e.$t("message.approach.rcr")},{default:d(()=>[o(b,{modelValue:s.value.rcr,"onUpdate:modelValue":a[5]||(a[5]=l=>s.value.rcr=l),icon:u($),options:f},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(p,{label:e.$t("message.approach.editable")},{default:d(()=>[o(b,{modelValue:s.value.editable,"onUpdate:modelValue":a[6]||(a[6]=l=>s.value.editable=l),icon:u($),options:f},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(p,{label:e.$t("message.approach.membership")},{default:d(()=>[o(b,{modelValue:s.value.miembro,"onUpdate:modelValue":a[7]||(a[7]=l=>s.value.miembro=l),icon:u($),options:u(C),readonly:z.value},null,8,["modelValue","icon","options","readonly"])]),_:1},8,["label"]),o(p,{label:e.$t("message.approach.status")},{default:d(()=>[o(b,{modelValue:s.value.estado,"onUpdate:modelValue":a[8]||(a[8]=l=>s.value.estado=l),icon:u($),options:D},null,8,["modelValue","icon"])]),_:1},8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"]),o(he,null,{default:d(()=>[o(ye,null,{default:d(()=>[o(Pe,{icon:e.mdiGlobeModel,title:e.$t("message.approach.approaches")},null,8,["icon","title"]),V("div",Ce,[V("div",Se,[o(I,{icon:u(A),label:e.$t("message.add_new"),color:"success",small:"",onClick:W},null,8,["icon","label"]),o(I,{icon:u(A),label:e.$t("message.edit"),color:"success",small:"",onClick:X},null,8,["icon","label"]),o(I,{icon:u(A),label:e.$t("message.delete"),color:"success",small:"",onClick:a[10]||(a[10]=l=>S.value=!0)},null,8,["icon","label"])])]),o(_e,{nodes:P.value,selectedNodeId:J.selectedNodeId,onNodeSelected:ae},null,8,["nodes","selectedNodeId"])]),_:1})]),_:1})],64))}};export{Ye as default};
