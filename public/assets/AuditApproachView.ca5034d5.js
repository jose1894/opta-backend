import{aq as F,ar as N,af as de,ag as ue,a9 as pe,R as se,I as m,y as d,o as b,r as M,j as l,E as w,J as H,K as Z,a as n,w as c,d as U,u,M as me,aO as ge,A as X,c as z,S as fe,aP as Ae,g as E,z as oe,O as je,Z as le,B as ne,C as re,aQ as xe,q as Ve,as as Ie,x as De,at as Fe,_ as Ne,an as Ue,aL as qe,i as Be}from"./index.cb093d8e.js";import{e as ie}from"./enfoques.service.e4996a7e.js";import{C as Me}from"./CardBoxComponentEmpty.87377cbc.js";const T="api/riesgos/",ce={index(i){return new Promise((r,s)=>{F.get(T,{params:i},{headers:N()}).then(e=>r(e.data)).catch(e=>s(e))})},create(i){return new Promise((r,s)=>{F.post(T,i,{headers:N()}).then(e=>r(e)).catch(e=>s(e))})},read(i){return new Promise((r,s)=>{F.get(`${T}/${i.id}`,{headers:N()}).then(e=>{r(e)}).catch(e=>s(e))})},update(i){return new Promise((r,s)=>{F.put(`${T}/${i._id}`,i,{headers:N()}).then(e=>r(e.data)).catch(e=>s(e))})},restore(i){return new Promise((r,s)=>{F.delete(`${T}/restore/${i}`,{headers:N()}).then(e=>r(e.data)).catch(e=>s(e))})},delete(i){return new Promise((r,s)=>{F.delete(`${T}${i}`,{headers:N()}).then(e=>r(e.data)).catch(e=>s(e))})}},te="api/uploads/",ae={create(i){return new Promise((r,s)=>{F.post(te,i,{headers:N(!0)}).then(e=>r(e)).catch(e=>s(e))})},read(i,r,s={}){return new Promise((e,L)=>{F.get(`${te}archivoProyectoYEnfoquesGet/${i}/${r}`,{params:s},{headers:N()}).then(S=>e(S.data)).catch(S=>L(S))})},downloadFiled(i){return new Promise((r,s)=>{F.get(`${te}download/${i}`,{headers:N()}).then(e=>r(e)).catch(e=>s(e))})}},Le=l("th",null,null,-1),Oe=["data-label"],Re={class:"before:hidden lg:w-1 whitespace-nowrap"},Je={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Te={__name:"RiskTableView",emits:["changePage","confirm","sort"],setup(i,{emit:r}){de(),ue(),pe();const s=se(),e=m(()=>s.filesProjectApproaches.Uploads),L=m(()=>s.filesProjectApproaches.total),S=m(()=>e.value),I=m(()=>s.filesProjectApproaches.perPage),C=m(()=>s.filesProjectApproaches.page),A=d(!1),j=g=>{A.value=!A.value,r("sort",g,A.value)},q=m(()=>Math.ceil(L.value/I.value)),R=m(()=>+C.value),x=m(()=>{const g=[];for(let V=0;V<q.value;V++)g.push(V);return g}),D=g=>{r("changePage",g)},J=g=>{console.log(g),ae.downloadFiled(g._id)};return(g,V)=>(b(),M(H,null,[l("table",null,[l("thead",null,[l("tr",null,[l("th",{onClick:V[0]||(V[0]=f=>j("nombre"))},w(g.$t("message.file.name")),1),Le])]),l("tbody",null,[(b(!0),M(H,null,Z(u(S),(f,B)=>(b(),M("tr",{key:f._id},[l("td",{"data-label":g.$t("message.file.name")},w(f.nombre),9,Oe),l("td",Re,[n(X,{type:"justify-start lg:justify-end","no-wrap":""},{default:c(()=>[n(U,{color:"info",icon:u(me),small:"",onClick:O=>J(f)},null,8,["icon","onClick"]),n(U,{color:"info",icon:u(ge),small:""},null,8,["icon"])]),_:2},1024)])]))),128))])]),l("div",Je,[n(fe,null,{default:c(()=>[n(X,null,{default:c(()=>[(b(!0),M(H,null,Z(u(x),f=>(b(),z(U,{key:f,active:f===u(C)-1,label:f+1,color:f===u(C)?"lightDark":"whiteDark",small:"",onClick:B=>D(f+1)},null,8,["active","label","color","onClick"]))),128))]),_:1}),l("small",null,"Page "+w(u(R))+" of "+w(u(q)),1)]),_:1})])],64))}},Ee={class:"mb-0"},He=l("label",{for:"formFile",class:"mb-0 inline-block text-neutral-700 dark:text-neutral-200"},"Default file input example",-1),ze={class:"grid md:grid-cols-1 gap-2"},Ge=l("th",null,null,-1),Ke=["data-label"],Qe=["data-label"],We={class:"before:hidden lg:w-1 whitespace-nowrap"},Ye={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Ze={__name:"AudiTableView",props:{path:"",saveLabel:"",state:{}},emits:["changePage","confirm","sort"],setup(i,{emit:r}){const s=i,{t:e}=de(),L=d(1),S=d(10),I=ue();pe();const C=d(!1),A=d(!1),j=se(),q=!1;Ae();const R=d(null),x=d(null),D=d(),{_id:J,codigo:g}=JSON.parse(localStorage.getItem("selectedProject")),V=m(()=>j.auditAproaches.enfoques),f=m(()=>j.auditAproaches.total),B=m(()=>j.auditAproaches.perPage),O=m(()=>j.auditAproaches.page),p=t=>{const o=JSON.parse(localStorage.getItem("selectedProject"));ee(o._id,D.value)},P=(t,o)=>{const a=JSON.parse(localStorage.getItem("selectedProject"));ee(a._id,D.value)},y=m(()=>V.value),h=d(!1),v=d({_id:"",indice:"",titulo:"",descripcion:"",proyecto:J}),W=t=>{h.value=!h.value,r("sort",t,h.value)},G=m(()=>Math.ceil(f.value/B.value)),K=m(()=>+O.value),he=m(()=>{const t=[];for(let o=0;o<G.value;o++)t.push(o);return t}),ve=t=>{r("changePage",t)},_e=async t=>{const{ruta:o,_id:a}=t,_=JSON.parse(localStorage.getItem("selectedProject"));R.value=`${_.codigo}/${o}`,D.value=a,ee(),setTimeout(()=>{A.value=!0},10)},ee=t=>{const o=JSON.parse(localStorage.getItem("selectedProject"));ae.read(o._id,D.value,t).then(a=>{console.log(a),j.filesProjectApproaches=a,L.value=a.page,S.value=a.perPage})},be=s.path==="create"?e("message.file.created.success"):e("message.file.updated.success");s.path==="create"?e("message.file.created.error"):e("message.file.updated.error");const Pe=async()=>{$e().then(()=>{A.value=!1,I.success(be)}).catch(t=>{var o,a,_,k;if(console.log(t),(a=(o=t.response)==null?void 0:o.data)!=null&&a.msg){I.error(`${e("message.file.created.error")} ${t.response.data.msg}`);return}if((k=(_=t.response)==null?void 0:_.data)!=null&&k.errors){const Q=t.response.data.errors;for(let Y of Q);}})},$e=async()=>{const t=new FormData;return t.append("archivo",x.value),t.append("ruta",R.value),t.append("nombre",x.value.name),t.append("type",x.value.type),t.append("proyecto",J),t.append("enfoque",D.value),ae.create(t)},ye=t=>{x.value=t.target.files[0]},ke=t=>{const{indice:o,_id:a}=t;v.value.indice=a,v.value.titulo="",v.value.descripcion="",setTimeout(()=>{C.value=!0},10)},we=s.path==="create"?e("message.audit.created.success"):e("message.audit.updated.success");s.path==="create"?e("message.audit.created.error"):e("message.audit.updated.error");const Se=async()=>{Ce(v).then(()=>{C.value=!1,I.success(we)}).catch(t=>{var o,a,_,k;if(console.log(t),(a=(o=t.response)==null?void 0:o.data)!=null&&a.msg){I.error(`${e("message.audit.created.error")} ${t.response.data.msg}`);return}if((k=(_=t.response)==null?void 0:_.data)!=null&&k.errors){const Q=t.response.data.errors;for(let Y of Q);}})},Ce=async t=>{const{_id:o,indice:a,titulo:_,descripcion:k,proyecto:Q}=t.value,Y={_id:o,indice:a,titulo:_,descripcion:k,proyecto:Q};return s.path==="create"?ce.create(Y):ce.update(Y)};return(t,o)=>(b(),M(H,null,[n(le,{modelValue:A.value,"onUpdate:modelValue":o[0]||(o[0]=a=>A.value=a),title:"Subir archivo",hasDone:q},{default:c(()=>{var a,_,k;return[n(E,{style:{padding:"0px"}},{default:c(()=>[n(E,{isForm:"",onSubmit:oe(Pe,["prevent"]),class:"bg-gray-200",style:{padding:"0px"}},{footer:c(()=>[n(U,{label:t.$t("message.submit"),type:"submit",color:"success"},null,8,["label"])]),default:c(()=>[l("div",Ee,[He,l("input",{class:"relative m-0 block w-full min-w-0 flex-auto rounded border border-solid border-neutral-300 bg-clip-padding px-3 py-[0.32rem] text-base font-normal text-neutral-700 transition duration-300 ease-in-out file:-mx-3 file:-my-[0.32rem] file:overflow-hidden file:rounded-none file:border-0 file:border-solid file:border-inherit file:bg-neutral-100 file:px-3 file:py-[0.32rem] file:text-neutral-700 file:transition file:duration-150 file:ease-in-out file:[border-inline-end-width:1px] file:[margin-inline-end:0.75rem] hover:file:bg-neutral-200 focus:border-primary focus:text-neutral-700 focus:shadow-te-primary focus:outline-none dark:border-neutral-600 dark:text-neutral-200 dark:file:bg-neutral-700 dark:file:text-neutral-100 dark:focus:border-primary",type:"file",ref_key:"archivo",ref:x,onChange:ye},null,544)])]),_:1},8,["onSubmit"])]),_:1}),(k=(_=(a=u(j))==null?void 0:a.filesProjectApproaches)==null?void 0:_.Uploads)!=null&&k.length?(b(),z(E,{key:0,class:"mb-6","has-table":""},{default:c(()=>[n(Te,{onChangePage:p,onSort:P})]),_:1})):je("",!0)]}),_:1},8,["modelValue"]),n(le,{modelValue:C.value,"onUpdate:modelValue":o[3]||(o[3]=a=>C.value=a),title:"Crear riego",hasDone:q},{default:c(()=>[n(E,{isForm:"",onSubmit:oe(Se,["prevent"])},{footer:c(()=>[n(U,{label:t.$t("message.submit"),type:"submit",color:"success"},null,8,["label"])]),default:c(()=>[l("div",ze,[n(ne,{label:t.$t("message.audit.title")},{default:c(()=>[n(re,{name:"indice",modelValue:v.value.titulo,"onUpdate:modelValue":o[1]||(o[1]=a=>v.value.titulo=a),icon:t.mdiCodeBraces},null,8,["modelValue","icon"])]),_:1},8,["label"]),n(ne,{label:t.$t("message.audit.description")},{default:c(()=>[n(re,{name:"descripcion",modelValue:v.value.descripcion,"onUpdate:modelValue":o[2]||(o[2]=a=>v.value.descripcion=a),icon:t.mdiCodeBraces},null,8,["modelValue","icon"])]),_:1},8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"]),l("table",null,[l("thead",null,[l("tr",null,[l("th",{onClick:o[4]||(o[4]=a=>W("indice"))},w(t.$t("message.audit.index")),1),l("th",{onClick:o[5]||(o[5]=a=>W("nombre"))},w(t.$t("message.audit.description")),1),Ge])]),l("tbody",null,[(b(!0),M(H,null,Z(u(y),(a,_)=>(b(),M("tr",{key:a._id},[l("td",{"data-label":t.$t("message.audit.index")},w(a.indice),9,Ke),l("td",{"data-label":t.$t("message.audit.description")},w(a.nombre),9,Qe),l("td",We,[n(X,{type:"justify-start lg:justify-end","no-wrap":""},{default:c(()=>[n(U,{color:"info",icon:u(xe),small:"",onClick:k=>ke(a)},null,8,["icon","onClick"]),n(U,{color:"info",icon:u(me),small:"",onClick:k=>_e(a)},null,8,["icon","onClick"]),n(U,{color:"info",icon:u(ge),small:""},null,8,["icon"])]),_:2},1024)])]))),128))])]),l("div",Ye,[n(fe,null,{default:c(()=>[n(X,null,{default:c(()=>[(b(!0),M(H,null,Z(u(he),a=>(b(),z(U,{key:a,active:a===u(O)-1,label:a+1,color:a===u(O)?"lightDark":"whiteDark",small:"",onClick:_=>ve(a+1)},null,8,["active","label","color","onClick"]))),128))]),_:1}),l("small",null,"Page "+w(u(K))+" of "+w(u(G)),1)]),_:1})])],64))}};const Xe={class:"grid grid-cols-1 sm:grid-cols-6 gap-2"},et={class:"container-treeview bg-gray-200 col-span-2"},tt={class:"container-table col-span-4"},at={class:"header-title"},st={class:"span-header-title"},ot={__name:"AuditApproachView",emits:["changePage","confirm","sort"],setup(i,{emit:r}){const s=d(1),e=d(),L=d(10),S=d([]),I=d(),C=d(),A=d(),j=Ie(),q=se(),R=De({selectedNodeId:null}),x=d([{name:"Inicio",link:"/setup/papers/"}]);d(0),d(-1);const D=p=>{V()},J=p=>{e.value=p,I.value=p==null?void 0:p.ruta,B()},g=(p,P)=>{f()},V=p=>{B()},f=(p,P)=>{B()},B=p=>{var $;const{_id:P}=($=e.value)!=null?$:{},y={page:s.value},h=P===void 0?1:P;console.log(e.value),ie.getChildrenWithPaginate(h,y).then(v=>{q.auditAproaches=v,s.value=v.page,L.value=v.perPage})};B({page:s.value}),Fe(async()=>{const{_id:p,codigo:P,nombre:y}=j.params;C.value=p,A.value=P,x.value.push({name:`${P} - ${y}`});let h=await ie.index();const{enfoques:$}=h,v=$.filter(K=>K.tipoNodo===0),W=$.filter(K=>K.tipoNodo!==0),G=O(v,W);S.value=G[0].children,console.log(G)});const O=(p,P=[])=>p.map(y=>{const h=P.filter($=>($==null?void 0:$.areaPadre)===y._id);return h.length>0&&(y.children=h,O(h,P)),y});return(p,P)=>(b(),z(Ne,null,{default:c(()=>[n(Be,null,{default:c(()=>{var y,h,$;return[n(Ue,{items:x.value},null,8,["items"]),l("div",Xe,[l("div",et,[n(qe,{nodes:S.value,treeView:!1,selectedNodeId:R.selectedNodeId,onItemSelected:J},null,8,["nodes","selectedNodeId"])]),l("div",tt,[($=(h=(y=u(q))==null?void 0:y.auditAproaches)==null?void 0:h.enfoques)!=null&&$.length?(b(),z(E,{key:0,class:"mb-6","has-table":""},{default:c(()=>[l("div",at,[l("span",st,w(I.value),1)]),n(Ze,{path:"create",onChangePage:D,onSort:g})]),_:1})):(b(),z(E,{key:1},{default:c(()=>[n(Me)]),_:1}))])])]}),_:1})]),_:1}))}},it=Ve(ot,[["__scopeId","data-v-dfed1f8a"]]);export{it as default};
