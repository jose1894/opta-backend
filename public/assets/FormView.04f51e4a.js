import{q as de,ag as ue,y as $,ah as re,at as me,aa as ce,I as pe,au as ge,o as R,c as be,w as r,j as t,M as W,a as s,d as H,aj as k,B as c,u as i,C as p,av as ve,aw as f,ax as F,E as _,r as J,K as fe,L as Ve,z as ye,g as $e}from"./index.e27aaed2.js";import{r as I,m as Ce,u as he}from"./index.esm.6263d8b1.js";import{c as _e}from"./cities.service.f962d969.js";import{s as we}from"./states.services.92a25f7c.js";import{a as N}from"./allies.service.894851e6.js";import{T as Ue}from"./TabsComponent.f3aa20e8.js";import{c as Fe}from"./countries.service.6413becf.js";import{c as Se}from"./cargos.service.90ce512d.js";const Be={class:"container mx-auto"},Le={class:"p-1 mt-0 bg-white border"},De={class:"grid md:grid-cols-3 gap-3"},Oe={class:"grid md:grid-cols-2 gap-3"},We={class:"grid gap-3"},ke={class:"grid md:grid-cols-2 gap-2"},Te={class:"grid md:grid-cols-2 gap-2"},je={class:"grid md:grid-cols-2 gap-2"},Ee=["data-label"],Me=["data-label"],Pe=["data-label"],Re={style:{display:"flex","justify-content":"space-between"}},Ie={__name:"FormView",props:{path:"",saveLabel:"",state:{}},setup(Q){const V=Q,{t:C}=ue();$([]);let T=$([]),S=$([]),B=$([]),j=$([]);const w=$(0),X=l=>{w.value=l},Y=[{title:"Aliado"},{title:"Contacto"},{title:"Referidos"}],E=[{id:1,label:C("message.ally.statuses.active")},{id:0,label:C("message.ally.statuses.inactive")}],a=$({_id:"",codigo:"00",nombre:"",iDFiscal:"",pais:T.value,state:S.value,ciudad:B.value,calle:"",paginaWeb:"",nombreContact:"",apellidoContact:"",cargo:j.value,telefonoOfic:"",telefonoCelu:"",correoContact:"",referido:[],estado:E[0]}),M=re(),Z=me(),q=ce(),x=pe(()=>({codigo:{required:I,maxLength:Ce(3)},nombre:{required:I},iDFiscal:{required:I}})),U=he(x,a);ge(async()=>{let l=await Fe.index();const e=(l==null?void 0:l.paises)||[];T.value=e.map(u=>({id:u._id,label:u.nombre}));let m=await Se.allCargos();const n=m==null?void 0:m.data.cargos;if(j.value=n.map(u=>({id:u._id,label:u.nombre})),V.path==="update"){const u=await N.read(Z.params),{aliado:d,referidos:g}=u.data;a.value=d;const{cargo:b,estado:y}=d;a.value.cargo={id:b._id,label:b.nombre},a.value.pais=P(d==null?void 0:d.pais),a.value.estado=E.filter(v=>v.id===y)[0],a.value.referidos=g,A(a.value.pais,d),console.log(a)}});const P=l=>({id:l._id,label:l.nombre}),A=(l,e={})=>{const{id:m}=l;B.value=[],S.value=[],ee(m).then(n=>{const u=(n==null?void 0:n.estados)||[];S.value=u.map(d=>({id:d._id,label:d.nombre})),V.path==="update"&&(a.value.state=P(e==null?void 0:e.state),z(a.value.state,e==null?void 0:e.ciudad))}).catch(n=>{console.log(n)})},ee=async l=>await we.estadosByPais(l),z=(l,e={})=>{const{id:m}=l;ae(m).then(n=>{const u=(n==null?void 0:n.ciudades)||[];B.value=u.map(d=>({id:d._id,label:d.nombre})),V.path==="update"&&(a.value.ciudad=P(e))}).catch(n=>{console.log(n)})},ae=async l=>await _e.ciudadesByEstados(l),le=l=>{const{_id:e,codigo:m,nombre:n,iDFiscal:u,pais:d,state:g,ciudad:b,calle:y,paginaWeb:v,nombreContact:h,apellidoContact:L,cargo:D,telefonoOfic:O,telefonoCelu:o,correoContact:K,estado:ne}=l.value,G={_id:e,codigo:m,nombre:n,iDFiscal:u,pais:d.id,state:g.id,ciudad:b.id,calle:y,paginaWeb:v,nombreContact:h,apellidoContact:L,cargo:D.id,telefonoOfic:O,telefonoCelu:o,correoContact:K,estado:ne.id};return V.path==="create"?N.create(G):N.update(G)},oe=V.path==="create"?C("message.ally.created.success"):C("message.ally.updated.success"),se=V.path==="create"?C("message.ally.created.error"):C("message.ally.updated.error"),te=async()=>{await U.value.$validate()?le(a).then(()=>{M.success(oe),q.push("/setup/allies")}).catch(e=>{var m,n,u;if((n=(m=e.response)==null?void 0:m.data)!=null&&n.msg){M.error(`${se} ${e.response.data.msg}`);return}if((u=e.response.data)!=null&&u.errors){const d=e.response.data.errors,g=Object.keys(d).map(function(b,y){const v=d[b];return v.length>1?v.map(h=>v[h]).join():v[0]});console.log(g.length,g),g.length>1?g.map(b=>g[b]).join():g[0],M.error("Error al procesar la data")}}):console.log("error")},ie=()=>q.push("/setup/allies");return(l,e)=>(R(),be($e,{isForm:"",onSubmit:ye(te,["prevent"])},{footer:r(()=>[t("div",Re,[W(s(H,{label:l.$t(`message.${V.saveLabel}`),type:"submit",color:"success"},null,8,["label"]),[[k,w.value===1]]),s(H,{label:l.$t("message.return"),color:"info",onClick:e[15]||(e[15]=m=>ie())},null,8,["label"])])]),default:r(()=>[t("div",null,[t("div",Be,[s(Ue,{tabs:Y,onTabClick:X},{default:r(()=>{var m,n,u,d,g,b,y,v,h,L,D,O;return[t("div",Le,[W(t("div",null,[t("div",De,[s(c,{label:l.$t("message.ally.code"),help:(u=(n=(m=i(U))==null?void 0:m.codigo)==null?void 0:n.$errors[0])==null?void 0:u.$message},{default:r(()=>[s(p,{name:"codigo",modelValue:a.value.codigo,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.codigo=o),icon:i(ve)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.name"),help:(b=(g=(d=i(U))==null?void 0:d.nombre)==null?void 0:g.$errors[0])==null?void 0:b.$message},{default:r(()=>[s(p,{modelValue:a.value.nombre,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.nombre=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.idFiscal"),help:(h=(v=(y=i(U))==null?void 0:y.iDFiscal)==null?void 0:v.$errors[0])==null?void 0:h.$message},{default:r(()=>[s(p,{modelValue:a.value.iDFiscal,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.iDFiscal=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.country")},{default:r(()=>[s(p,{modelValue:a.value.pais,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.pais=o),icon:i(F),options:i(T),onOnSelectChange:A},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.state")},{default:r(()=>[s(p,{modelValue:a.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.state=o),icon:i(F),options:i(S),onOnSelectChange:z},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.city")},{default:r(()=>[s(p,{modelValue:a.value.ciudad,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.ciudad=o),icon:i(F),options:i(B)},null,8,["modelValue","icon","options"])]),_:1},8,["label"])]),t("div",Oe,[s(c,{label:l.$t("message.ally.paginaWeb"),help:(O=(D=(L=i(U))==null?void 0:L.paginaWeb)==null?void 0:D.$errors[0])==null?void 0:O.$message},{default:r(()=>[s(p,{modelValue:a.value.paginaWeb,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.paginaWeb=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.status")},{default:r(()=>[s(p,{modelValue:a.value.estado,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.estado=o),icon:i(F),options:E},null,8,["modelValue","icon"])]),_:1},8,["label"])]),t("div",We,[s(c,{label:l.$t("message.ally.address")},{default:r(()=>[s(p,{type:"textarea",modelValue:a.value.direccion,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.direccion=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])])],512),[[k,w.value===0]]),W(t("div",null,[t("div",ke,[s(c,{label:l.$t("message.ally.name")},{default:r(()=>[s(p,{modelValue:a.value.nombreContact,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.nombreContact=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.lastName")},{default:r(()=>[s(p,{modelValue:a.value.apellidoContact,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.apellidoContact=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),t("div",Te,[s(c,{label:l.$t("message.ally.cargo")},{default:r(()=>[s(p,{modelValue:a.value.cargo,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.cargo=o),icon:i(F),options:i(j)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.officePhone")},{default:r(()=>[s(p,{modelValue:a.value.telefonoOfic,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.telefonoOfic=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),t("div",je,[s(c,{label:l.$t("message.ally.movilPhone")},{default:r(()=>[s(p,{modelValue:a.value.telefonoCelu,"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.telefonoCelu=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.email")},{default:r(()=>[s(p,{modelValue:a.value.correoContact,"onUpdate:modelValue":e[14]||(e[14]=o=>a.value.correoContact=o),icon:i(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])])],512),[[k,w.value===1]]),W(t("div",null,[t("table",null,[t("thead",null,[t("tr",null,[t("th",null,_(l.$t("message.member.id")),1),t("th",null,_(l.$t("message.member.name")),1),t("th",null,_(l.$t("message.member.paginaWeb")),1)])]),t("tbody",null,[(R(!0),J(fe,null,Ve(a.value.referidos,(o,K)=>(R(),J("tr",{key:o._id},[t("td",{"data-label":l.$t("message.member.id")},_(o.iDFiscal),9,Ee),t("td",{"data-label":l.$t("message.member.name")},_(o.nombre),9,Me),t("td",{"data-label":l.$t("message.member.paginaWeb")},_(o.paginaWeb),9,Pe)]))),128))])])],512),[[k,w.value===2]])])]}),_:1})])])]),_:1},8,["onSubmit"]))}},Qe=de(Ie,[["__scopeId","data-v-f0e8ae73"]]);export{Qe as F};
