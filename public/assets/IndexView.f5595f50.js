import{aq as S,ar as D,y as _,x as ne,I as P,af as Ce,ag as ke,a9 as Ve,R as le,o as f,r as U,a as r,w as p,j as n,f as J,E as h,Z as ee,d as C,B as K,J as O,K as R,u,c as k,A as G,ak as ae,ap as re,aj as Ie,P as Se,ai as De,S as Ue,_ as Ee,b as se,O as te,e as Ne,g as oe,i as Me,ao as Be}from"./index.94f69dfc.js";import{C as Fe}from"./CardBoxComponentEmpty.c052dd4c.js";import{_ as ce}from"./FormCheckRadioGroup.7dc4317c.js";import{p as W}from"./projects.service.1804ab4d.js";import{p as Le}from"./personal.service.551a9226.js";import{A as Oe}from"./Autocomplete.ddbf0388.js";import"./FormCheckRadio.7aa78bc3.js";const E="api/personasProyectos/",T={create(g){return new Promise((c,l)=>{S.post(E,g,{headers:D()}).then(t=>c(t)).catch(t=>l(t))})},read(g){return new Promise((c,l)=>{S.get(`${E}/${g._id}`,{headers:D()}).then(t=>{c(t)}).catch(t=>l(t))})},update(g){return new Promise((c,l)=>{S.put(`${E}/${g._id}`,g,{headers:D()}).then(t=>c(t.data)).catch(t=>l(t))})},delete(g){return new Promise((c,l)=>{S.delete(`${E}${g.id}/${g.personaId}`,{headers:D()}).then(t=>c(t.data)).catch(t=>l(t))})},restore(g){return new Promise((c,l)=>{S.delete(`${E}/restore/${g}`,{headers:D()}).then(t=>c(t.data)).catch(t=>l(t))})}},Te={class:"grid md:grid-cols-1 gap-1"},Ae=n("div",{class:"grid md:grid-cols-1 gap-1"},[n("h2",null," Encargado ")],-1),qe={class:"grid md:grid-cols-1 gap-1"},He=n("th",null,null,-1),Re=["onClick"],Ge=["data-label"],Je=["data-label"],Ke=["data-label"],We=["data-label"],Ze={class:"before:hidden lg:w-1 whitespace-nowrap"},ze={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Qe={__name:"ProjectTable.view",props:{checkable:Boolean},emits:["changePage","confirm","sort"],setup(g,{emit:c}){let l=_([]);const t=ne({radio:[]}),$=P(()=>l.value),v=_([]),{t:V}=Ce(),w=ke(),A=Ve(),y=le(),N=P(()=>y.projects.proyectos),q=P(()=>y.projects.total);_(!1);const o=_(!1),d=_(!1),M=P(()=>y.projects.perPage),j=P(()=>y.projects.page);_([]);const b=_([]),B=P(()=>N.value),F=(e="")=>({0:"inactive",1:"active",2:"deleted"})[e],I=_(!1),L=e=>{I.value=!I.value,c("sort",e,I.value)},Z=P(()=>Math.ceil(q.value/M.value)),de=P(()=>+j.value),ue=P(()=>{const e=[];for(let a=0;a<Z.value;a++)e.push(a);return e}),ie=e=>{c("changePage",e)},pe=e=>{A.push({name:"ProjectsUpdate",params:{id:e}})},ge=async e=>{X(),(await T.read(e)).data.personas.map(s=>{H(s,"Update")})},me=e=>b.value=e,z=(e=!1)=>{const{codigo:a}=b.value;return e?`${V("message.project.project")} ${a}`:a},Q=V("message.project.deleted.success"),he=async()=>{fe().then(()=>{w.success(Q),c("changePage",j.value)}).catch(e=>{var a;w.error(`${V("message.project.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},ve=async()=>{_e().then(()=>{w.success(Q),c("changePage",j.value)}).catch(e=>{var a;w.error(`${V("message.project.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},X=()=>{l.value=[],v.value=[]},fe=()=>{const{_id:e}=b.value;return W.delete(e)},_e=()=>(console.log(v.value),T.create(v.value)),$e=async e=>{var i;const a=e===""?"default":e;return((i=(await Le.searchPersona(a)).data)==null?void 0:i.personas)||[]},be=e=>{console.log(l.value),l.value.filter(m=>Object.keys(m).some(i=>i===e._id)).length===0?H(e,"New"):w.error("El registro ya fue seleccionado")},H=(e,a)=>{var Y,x;const m=[a==="New"?e:e==null?void 0:e.personaId],i=Pe(m)[0];l.value.push(i);const ye={_id:a==="New"?"":e==null?void 0:e._id,projectId:b.value._id,personaId:a==="New"?e._id:(Y=e==null?void 0:e.personaId)==null?void 0:Y._id,encargado:a==="New"?!1:e==null?void 0:e.encargado,persisteState:a};v.value.push(ye),a==="Update"&&(e==null?void 0:e.encargado)&&(t.radio=(x=e==null?void 0:e.personaId)==null?void 0:x._id)},Pe=e=>e.map(({_id:a,nombres:s,apellidos:m})=>({[a]:`${s} ${m}`})),je=e=>{const a=t.radio;v.value=v.value.map(s=>(s.encargado=a===s.personaId,s)),console.log(v.value)},we=async e=>{const{_id:a}=b.value,s={personaId:Object.keys(e)[0],id:a};await T.delete(s),v.value=[],l.value=[],(await T.read(b.value)).data.personas.map(i=>{H(i,"Update")})};return(e,a)=>(f(),U(O,null,[r(ee,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=s=>d.value=s),title:"Please confirm",button:"danger",onConfirm:he,"has-cancel":""},{default:p(()=>[n("strong",null,[J(h(e.$t("message.project.deleted.question"))+" ",1),n("b",null,h(z()),1)]),J(" ? ")]),_:1},8,["modelValue"]),r(ee,{modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=s=>o.value=s),title:z(!0),button:"danger",onConfirm:ve,onCancel:X,"has-cancel":""},{footer:p(()=>[r(C,{label:e.$t("message.submit"),color:"success"},null,8,["label"])]),default:p(()=>[n("div",Te,[r(K,{label:e.$t("message.project.person")},{default:p(()=>[r(Oe,{placeholder:"Buscar...","search-function":$e,"render-function":be,"debounce-time":500},null,8,["placeholder"])]),_:1},8,["label"])]),Ae,n("div",qe,[(f(!0),U(O,null,R(u($),(s,m)=>(f(),k(K,{label:""},{default:p(()=>[r(ce,{modelValue:t.radio,"onUpdate:modelValue":a[1]||(a[1]=i=>t.radio=i),name:"sample-radio",type:"radio",isColumn:"true",options:u($)[m],onChange:i=>je(u($)[m])},null,8,["modelValue","options","onChange"]),r(G,{type:"justify-start lg:justify-end","no-wrap":""},{default:p(()=>[r(C,{color:"danger",icon:u(ae),small:"",style:{width:"28px",height:"28px"},onClick:i=>we(u($)[m])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024))),256))])]),_:1},8,["modelValue","title"]),n("table",null,[n("thead",null,[n("tr",null,[n("th",{onClick:a[3]||(a[3]=s=>L("codigo"))},h(e.$t("message.project.code")),1),n("th",{onClick:a[4]||(a[4]=s=>L("cliente"))},h(e.$t("message.project.client")),1),n("th",{onClick:a[5]||(a[5]=s=>L("socio"))},h(e.$t("message.project.partner")),1),n("th",{onClick:a[6]||(a[6]=s=>L("estado"))},h(e.$t("message.project.status")),1),He])]),n("tbody",null,[(f(!0),U(O,null,R(u(B),(s,m)=>(f(),U("tr",{key:s._id,onClick:i=>me(s)},[n("td",{"data-label":e.$t("message.project.code")},h(s.codigo),9,Ge),n("td",{"data-label":e.$t("message.project.client")},h(s.cliente.nombre),9,Je),n("td",{"data-label":e.$t("message.project.partner")},h(s.socio.nombres),9,Ke),n("td",{"data-label":e.$t("message.project.status")},h(e.$t(`message.project.statuses.${F(s.estado)}`)),9,We),n("td",Ze,[r(G,{type:"justify-start lg:justify-end","no-wrap":""},{default:p(()=>[r(C,{color:"success",icon:u(re),small:"",onClick:i=>(ge(s),o.value=!0)},null,8,["icon","onClick"]),r(C,{color:"info",icon:u(Ie),small:"",onClick:i=>pe(s._id)},null,8,["icon","onClick"]),Se(r(C,{color:"danger",icon:u(ae),small:"",onClick:a[7]||(a[7]=i=>d.value=!0)},null,8,["icon"]),[[De,s.estado!==2]])]),_:2},1024)])],8,Re))),128))])]),n("div",ze,[r(Ue,null,{default:p(()=>[r(G,null,{default:p(()=>[(f(!0),U(O,null,R(u(ue),s=>(f(),k(C,{key:s,active:s===u(j)-1,label:s+1,color:s===u(j)?"lightDark":"whiteDark",small:"",onClick:m=>ie(s+1)},null,8,["active","label","color","onClick"]))),128))]),_:1}),n("small",null,"Page "+h(u(de))+" of "+h(u(Z)),1)]),_:1})])],64))}},oa={__name:"IndexView",setup(g){const c=le(),l=_(1),t=_(10),$=ne({switch:[]}),v=o=>{W.index(o).then(d=>{c.projects=d,l.value=d.page,t.value=d.perPage})};v({page:l.value});const V=()=>{N({page:l.value})},w=o=>{N({page:o})},A=(o,d)=>{q({sortBy:o,sortDesc:d})},y=o=>{W.getDelete(o).then(d=>{c.projects=d,l.value=d.page,t.value=d.perPage})},N=o=>{$.switch.length===0?v({page:o}):y({page:o})},q=(o,d)=>{$.switch.length===0?v({sortBy:o,sortDesc:d}):y({sortBy:o,sortDesc:d})};return(o,d)=>(f(),k(Ee,null,{default:p(()=>[r(Me,null,{default:p(()=>{var M,j,b,B,F;return[r(se,{icon:u(Be),title:o.$t("message.project.projects")},{default:p(()=>[r(C,{to:"projects/create",icon:u(re),label:o.$t("message.add_new"),color:"success",small:""},null,8,["icon","label"])]),_:1},8,["icon","title"]),r(K,{label:""},{default:p(()=>[r(ce,{modelValue:$.switch,"onUpdate:modelValue":d[0]||(d[0]=I=>$.switch=I),name:"sample-switch",type:"switch",options:{one:"Mostrar registros eliminados"},onChange:V},null,8,["modelValue"])]),_:1}),(M=u(c))!=null&&M.projects?te("",!0):(f(),k(se,{key:0,icon:o.mdiTableOff,title:"Empty variation"},null,8,["icon"])),(j=u(c))!=null&&j.projects?te("",!0):(f(),k(Ne,{key:1,color:"danger",icon:o.mdiTableOff},{default:p(()=>[n("b",null,h(o.$t("message.empty_table"))+".",1),J(" When there's nothing to show ")]),_:1},8,["icon"])),(F=(B=(b=u(c))==null?void 0:b.projects)==null?void 0:B.proyectos)!=null&&F.length?(f(),k(oe,{key:2,class:"mb-6","has-table":""},{default:p(()=>[r(Qe,{onChangePage:w,onSort:A})]),_:1})):(f(),k(oe,{key:3},{default:p(()=>[r(Fe)]),_:1}))]}),_:1})]),_:1}))}};export{oa as default};
