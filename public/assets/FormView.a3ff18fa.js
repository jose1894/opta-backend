import{q as ie,af as ne,y as C,ag as de,as as ue,a9 as re,I as me,at as ce,o as R,c as pe,w as r,P as W,a as s,d as ge,ai as k,j as i,B as c,u as t,C as p,au as be,av as f,aw as F,E as h,r as K,J as ve,K as fe,z as Ve,g as ye}from"./index.cb093d8e.js";import{r as I,m as $e,u as Ce}from"./index.esm.25e21f11.js";import{c as _e}from"./cities.service.74c9cbb1.js";import{s as he}from"./states.services.652d1538.js";import{a as N}from"./allies.service.373ee531.js";import{T as we}from"./TabsComponent.7d98a363.js";import{c as Ue}from"./countries.service.19451b6a.js";import{c as Fe}from"./cargos.service.2d46b024.js";const Se={class:"container mx-auto"},Be={class:"p-1 mt-0 bg-white border"},Le={class:"grid md:grid-cols-3 gap-3"},De={class:"grid md:grid-cols-2 gap-3"},Oe={class:"grid gap-3"},We={class:"grid md:grid-cols-2 gap-2"},ke={class:"grid md:grid-cols-2 gap-2"},Te={class:"grid md:grid-cols-2 gap-2"},Ee=["data-label"],Pe=["data-label"],je=["data-label"],Me={__name:"FormView",props:{path:"",saveLabel:"",state:{}},setup(G){const V=G,{t:y}=ne();C([]);let T=C([]),S=C([]),B=C([]),E=C([]);const w=C(0),H=l=>{w.value=l},Q=[{title:"Aliado"},{title:"Contacto"},{title:"Referidos"}],P=[{id:1,label:y("message.ally.statuses.active")},{id:0,label:y("message.ally.statuses.inactive")},{id:2,label:y("message.ally.statuses.deleted")}],a=C({_id:"",codigo:"00",nombre:"",iDFiscal:"",pais:T.value,state:S.value,ciudad:B.value,calle:"",paginaWeb:"",nombreContact:"",apellidoContact:"",cargo:E.value,telefonoOfic:"",telefonoCelu:"",correoContact:"",referido:[],estado:P[0]}),j=de(),X=ue(),Y=re(),Z=me(()=>({codigo:{required:I,maxLength:$e(3)},nombre:{required:I},iDFiscal:{required:I}})),U=Ce(Z,a);ce(async()=>{let l=await Ue.index();const e=(l==null?void 0:l.paises)||[];T.value=e.map(u=>({id:u._id,label:u.nombre}));let m=await Fe.allCargos();const n=m==null?void 0:m.data.cargos;if(E.value=n.map(u=>({id:u._id,label:u.nombre})),V.path==="update"){const u=await N.read(X.params),{aliado:d,referidos:g}=u.data;a.value=d;const{cargo:b,estado:$}=d;a.value.cargo={id:b._id,label:b.nombre},a.value.pais=M(d==null?void 0:d.pais),a.value.estado=P.filter(v=>v.id===$)[0],a.value.referidos=g,q(a.value.pais,d),console.log(a)}});const M=l=>({id:l._id,label:l.nombre}),q=(l,e={})=>{const{id:m}=l;B.value=[],S.value=[],x(m).then(n=>{const u=(n==null?void 0:n.estados)||[];S.value=u.map(d=>({id:d._id,label:d.nombre})),V.path==="update"&&(a.value.state=M(e==null?void 0:e.state),A(a.value.state,e==null?void 0:e.ciudad))}).catch(n=>{console.log(n)})},x=async l=>await he.estadosByPais(l),A=(l,e={})=>{const{id:m}=l;ee(m).then(n=>{const u=(n==null?void 0:n.ciudades)||[];B.value=u.map(d=>({id:d._id,label:d.nombre})),V.path==="update"&&(a.value.ciudad=M(e))}).catch(n=>{console.log(n)})},ee=async l=>await _e.ciudadesByEstados(l),ae=l=>{const{_id:e,codigo:m,nombre:n,iDFiscal:u,pais:d,state:g,ciudad:b,calle:$,paginaWeb:v,nombreContact:_,apellidoContact:L,cargo:D,telefonoOfic:O,telefonoCelu:o,correoContact:z,estado:te}=l.value,J={_id:e,codigo:m,nombre:n,iDFiscal:u,pais:d.id,state:g.id,ciudad:b.id,calle:$,paginaWeb:v,nombreContact:_,apellidoContact:L,cargo:D.id,telefonoOfic:O,telefonoCelu:o,correoContact:z,estado:te.id};return V.path==="create"?N.create(J):N.update(J)},le=V.path==="create"?y("message.ally.created.success"):y("message.ally.updated.success"),oe=V.path==="create"?y("message.ally.created.error"):y("message.ally.updated.error"),se=async()=>{await U.value.$validate()?ae(a).then(()=>{j.success(le),Y.push("/setup/allies")}).catch(e=>{var m,n,u;if((n=(m=e.response)==null?void 0:m.data)!=null&&n.msg){j.error(`${oe} ${e.response.data.msg}`);return}if((u=e.response.data)!=null&&u.errors){const d=e.response.data.errors,g=Object.keys(d).map(function(b,$){const v=d[b];return v.length>1?v.map(_=>v[_]).join():v[0]});console.log(g.length,g),g.length>1?g.map(b=>g[b]).join():g[0],j.error("Error al procesar la data")}}):console.log("error")};return(l,e)=>(R(),pe(ye,{isForm:"",onSubmit:Ve(se,["prevent"])},{footer:r(()=>[W(s(ge,{label:l.$t(`message.${V.saveLabel}`),type:"submit",color:"success"},null,8,["label"]),[[k,w.value===1]])]),default:r(()=>[i("div",null,[i("div",Se,[s(we,{tabs:Q,onTabClick:H},{default:r(()=>{var m,n,u,d,g,b,$,v,_,L,D,O;return[i("div",Be,[W(i("div",null,[i("div",Le,[s(c,{label:l.$t("message.ally.code"),help:(u=(n=(m=t(U))==null?void 0:m.codigo)==null?void 0:n.$errors[0])==null?void 0:u.$message},{default:r(()=>[s(p,{name:"codigo",modelValue:a.value.codigo,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.codigo=o),icon:t(be)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.name"),help:(b=(g=(d=t(U))==null?void 0:d.nombre)==null?void 0:g.$errors[0])==null?void 0:b.$message},{default:r(()=>[s(p,{modelValue:a.value.nombre,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.nombre=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.idFiscal"),help:(_=(v=($=t(U))==null?void 0:$.iDFiscal)==null?void 0:v.$errors[0])==null?void 0:_.$message},{default:r(()=>[s(p,{modelValue:a.value.iDFiscal,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.iDFiscal=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.country")},{default:r(()=>[s(p,{modelValue:a.value.pais,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.pais=o),icon:t(F),options:t(T),onOnSelectChange:q},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.state")},{default:r(()=>[s(p,{modelValue:a.value.state,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.state=o),icon:t(F),options:t(S),onOnSelectChange:A},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.city")},{default:r(()=>[s(p,{modelValue:a.value.ciudad,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.ciudad=o),icon:t(F),options:t(B)},null,8,["modelValue","icon","options"])]),_:1},8,["label"])]),i("div",De,[s(c,{label:l.$t("message.ally.paginaWeb"),help:(O=(D=(L=t(U))==null?void 0:L.paginaWeb)==null?void 0:D.$errors[0])==null?void 0:O.$message},{default:r(()=>[s(p,{modelValue:a.value.paginaWeb,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.paginaWeb=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),s(c,{label:l.$t("message.ally.status")},{default:r(()=>[s(p,{modelValue:a.value.estado,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.estado=o),icon:t(F),options:P},null,8,["modelValue","icon"])]),_:1},8,["label"])]),i("div",Oe,[s(c,{label:l.$t("message.ally.address")},{default:r(()=>[s(p,{type:"textarea",modelValue:a.value.direccion,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.direccion=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])])],512),[[k,w.value===0]]),W(i("div",null,[i("div",We,[s(c,{label:l.$t("message.ally.name")},{default:r(()=>[s(p,{modelValue:a.value.nombreContact,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.nombreContact=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.lastName")},{default:r(()=>[s(p,{modelValue:a.value.apellidoContact,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.apellidoContact=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),i("div",ke,[s(c,{label:l.$t("message.ally.cargo")},{default:r(()=>[s(p,{modelValue:a.value.cargo,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.cargo=o),icon:t(F),options:t(E)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.officePhone")},{default:r(()=>[s(p,{modelValue:a.value.telefonoOfic,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.telefonoOfic=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),i("div",Te,[s(c,{label:l.$t("message.ally.movilPhone")},{default:r(()=>[s(p,{modelValue:a.value.telefonoCelu,"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.telefonoCelu=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(c,{label:l.$t("message.ally.email")},{default:r(()=>[s(p,{modelValue:a.value.correoContact,"onUpdate:modelValue":e[14]||(e[14]=o=>a.value.correoContact=o),icon:t(f)},null,8,["modelValue","icon"])]),_:1},8,["label"])])],512),[[k,w.value===1]]),W(i("div",null,[i("table",null,[i("thead",null,[i("tr",null,[i("th",null,h(l.$t("message.member.id")),1),i("th",null,h(l.$t("message.member.name")),1),i("th",null,h(l.$t("message.member.paginaWeb")),1)])]),i("tbody",null,[(R(!0),K(ve,null,fe(a.value.referidos,(o,z)=>(R(),K("tr",{key:o._id},[i("td",{"data-label":l.$t("message.member.id")},h(o.iDFiscal),9,Ee),i("td",{"data-label":l.$t("message.member.name")},h(o.nombre),9,Pe),i("td",{"data-label":l.$t("message.member.paginaWeb")},h(o.paginaWeb),9,je)]))),128))])])],512),[[k,w.value===2]])])]}),_:1})])])]),_:1},8,["onSubmit"]))}},Ge=ie(Me,[["__scopeId","data-v-631381da"]]);export{Ge as F};
