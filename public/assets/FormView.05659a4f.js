import{af as T,ag as D,as as E,a9 as H,y as w,at as J,I as K,o as P,c as Q,w as b,a as o,d as W,j as O,B as g,C as p,u as r,aw as V,av as R,z as X,g as Y}from"./index.94f69dfc.js";import{r as U,m as Z,u as x}from"./index.esm.8eaf8d5b.js";import{a as L}from"./activities.service.13519c79.js";import{m as ee}from"./member.service.cf66150f.js";import{b as ae}from"./bussinesUnit.service.435050ca.js";const se={class:"grid md:grid-cols-3 gap-4"},te={class:"grid md:grid-cols-3 gap-3"},de={__name:"FormView",props:{path:"",saveLabel:"",activity:{}},setup(k){const v=k,{t:n}=T(),S=D(),F=E(),G=H();let $=w([]),h=w([]);const _=[{id:1,label:n("message.activity.statuses.active")},{id:0,label:n("message.activity.statuses.inactive")},{id:2,label:n("message.activity.statuses.deleted")}],N=[{id:0,label:n("message.activity.chargeable")},{id:1,label:n("message.activity.non-chargeable")}],s=w({_id:"",unidadNegocio:h.value,siglas:"",nombre:"",cargable:N[0],miembro:$.value,estado:_[0]}),I=e=>{const{_id:a,unidadNegocio:l,siglas:d,nombre:u,cargable:m,miembro:t,estado:c}=e.value,f={_id:a,unidadNegocio:l.id,siglas:d,nombre:u,cargable:m.id,miembro:t.id,estado:c.id};return v.path==="create"?L.create(f):L.update(f)};J(async()=>{var u,m;let e=await ee.allMiembrosGet();const a=e==null?void 0:e.data.miembros;$.value=a.map(t=>({id:t._id,label:t.nombre}));let l=await ae.allBussinesUnitGet();const d=l==null?void 0:l.data.unidadesNegocio;if(h.value=d.map(t=>({id:t._id,label:t.nombre})),v.path==="update"){const t=await L.read(F.params);s.value=t.data,s.value.unidadNegocio=B((u=t.data)==null?void 0:u.unidadNegocio),s.value.miembro=B((m=t.data)==null?void 0:m.miembro),s.value.cargable=N.filter(c=>c.id===t.data.cargable)[0],s.value.estado=_.filter(c=>c.id===t.data.estado)[0]}});const B=e=>({id:e._id,label:(e==null?void 0:e.nombre)||(e==null?void 0:e.descripcion)}),j=K(()=>({siglas:{required:U,maxLength:Z(4)},nombre:{required:U},estado:{required:U}})),y=x(j,s),q=v.path==="create"?n("message.activity.created.success"):n("message.activity.updated.success"),z=v.path==="create"?n("message.activity.created.error"):n("message.activity.updated.error"),A=async()=>{await y.value.$validate()?I(s).then(()=>{S.success(q),G.push("/setup/activities")}).catch(a=>{var l,d;if((l=a.response.data)!=null&&l.msg){S.error(`${z} ${a.response.data.msg}`);return}if((d=a.response.data)!=null&&d.errors){const u=a.response.data.errors;for(let m of u);}}):console.log("error")};return(e,a)=>(P(),Q(Y,{isForm:"",onSubmit:X(A,["prevent"])},{footer:b(()=>[o(W,{label:e.$t(`message.${v.saveLabel}`),type:"submit",color:"success"},null,8,["label"])]),default:b(()=>{var l,d,u,m,t,c,f,M,C;return[O("div",se,[o(g,{label:e.$t("message.activity.bussinesUnit")},{default:b(()=>[o(p,{modelValue:s.value.unidadNegocio,"onUpdate:modelValue":a[0]||(a[0]=i=>s.value.unidadNegocio=i),icon:r(V),options:r(h)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(g,{label:e.$t("message.activity.acronyms"),help:(u=(d=(l=r(y))==null?void 0:l.siglas)==null?void 0:d.$errors[0])==null?void 0:u.$message},{default:b(()=>[o(p,{modelValue:s.value.siglas,"onUpdate:modelValue":a[1]||(a[1]=i=>s.value.siglas=i),icon:r(R)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),o(g,{label:e.$t("message.activity.name"),help:(c=(t=(m=r(y))==null?void 0:m.nombre)==null?void 0:t.$errors[0])==null?void 0:c.$message},{default:b(()=>[o(p,{modelValue:s.value.nombre,"onUpdate:modelValue":a[2]||(a[2]=i=>s.value.nombre=i),icon:r(R)},null,8,["modelValue","icon"])]),_:1},8,["label","help"])]),O("div",te,[o(g,{label:e.$t("message.activity.chargeable")},{default:b(()=>[o(p,{modelValue:s.value.cargable,"onUpdate:modelValue":a[3]||(a[3]=i=>s.value.cargable=i),icon:r(V),options:N},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(g,{label:e.$t("message.activity.membership")},{default:b(()=>[o(p,{modelValue:s.value.miembro,"onUpdate:modelValue":a[4]||(a[4]=i=>s.value.miembro=i),icon:r(V),options:r($)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(g,{label:e.$t("message.activity.status"),help:(C=(M=(f=r(y))==null?void 0:f.estado)==null?void 0:M.$errors[0])==null?void 0:C.$message},{default:b(()=>[o(p,{modelValue:s.value.estado,"onUpdate:modelValue":a[5]||(a[5]=i=>s.value.estado=i),icon:r(V),options:_},null,8,["modelValue","icon"])]),_:1},8,["label","help"])])]}),_:1},8,["onSubmit"]))}};export{de as _};
