import{aq as D,ar as U,y as _,x as le,I as j,af as we,ag as ye,a9 as ke,R as re,aI as Ve,o as f,r as E,a as l,w as i,j as n,f as K,E as h,Z as ae,d as k,B as W,J as T,K as H,u,c as V,A as J,ak as te,ap as ce,aj as Ie,P as Se,ai as De,S as Ue,_ as Ee,b as se,O as oe,e as Ne,g as ne,i as Fe,ao as Me}from"./index.2b059d96.js";import{C as Be}from"./CardBoxComponentEmpty.c5973077.js";import{_ as Le}from"./FormCheckRadioGroup.f120ae1c.js";import{p as Z}from"./projects.service.df660d88.js";import{p as Oe}from"./personal.service.0fd3126d.js";import{A as Te}from"./Autocomplete.19829013.js";import"./FormCheckRadio.b0cf8ca6.js";const N="api/personasProyectos/",A={create(m){return new Promise((r,c)=>{D.post(N,m,{headers:U()}).then(s=>r(s)).catch(s=>c(s))})},read(m){return new Promise((r,c)=>{D.get(`${N}/${m._id}`,{headers:U()}).then(s=>{r(s)}).catch(s=>c(s))})},update(m){return new Promise((r,c)=>{D.put(`${N}/${m._id}`,m,{headers:U()}).then(s=>r(s.data)).catch(s=>c(s))})},delete(m){return new Promise((r,c)=>{D.delete(`${N}${m.id}/${m.personaId}`,{headers:U()}).then(s=>r(s.data)).catch(s=>c(s))})},restore(m){return new Promise((r,c)=>{D.delete(`${N}/restore/${m}`,{headers:U()}).then(s=>r(s.data)).catch(s=>c(s))})}},Ae={class:"grid md:grid-cols-1 gap-1"},Re=n("div",{class:"grid md:grid-cols-1 gap-1"},[n("h2",null," Encargado ")],-1),Ge={class:"grid md:grid-cols-1 gap-1"},qe=n("th",null,null,-1),He=["onClick"],Je=["data-label"],Ke=["data-label"],We=["data-label"],Ze=["data-label"],ze={class:"before:hidden lg:w-1 whitespace-nowrap"},Qe={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Xe={__name:"ProjectTable.view",props:{checkable:Boolean},emits:["changePage","confirm","sort"],setup(m,{emit:r}){let c=_([]);const s=le({radio:[]}),$=j(()=>c.value),v=_([]),{t:I}=we(),w=ye(),R=ke(),y=re(),F=j(()=>y.projects.proyectos),G=j(()=>y.projects.total);_(!1);const o=_(!1),d=_(!1),M=j(()=>y.projects.perPage),C=j(()=>y.projects.page);_([]);const b=_([]),B=j(()=>F.value),L=(e="")=>({0:"inactive",1:"active",2:"deleted"})[e],S=_(!1),O=e=>{S.value=!S.value,r("sort",e,S.value)},z=j(()=>Math.ceil(G.value/M.value)),de=j(()=>+C.value),ue=j(()=>{const e=[];for(let a=0;a<z.value;a++)e.push(a);return e}),ie=e=>{r("changePage",e)},pe=e=>{R.push({name:"ProjectsUpdate",params:{id:e}})},ge=async e=>{Y(),(await A.read(e)).data.personas.map(p=>{q(p,"Update")})},me=e=>b.value=e,Q=(e=!1)=>{const{codigo:a}=b.value;return e?`${I("message.project.project")} ${a}`:a},X=I("message.project.deleted.success"),he=async()=>{fe().then(()=>{w.success(X),r("changePage",C.value)}).catch(e=>{var a;w.error(`${I("message.project.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},ve=async()=>{_e().then(()=>{w.success(X),r("changePage",C.value)}).catch(e=>{var a;w.error(`${I("message.project.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},Y=()=>{c.value=[],v.value=[]},fe=()=>{const{_id:e}=b.value;return Z.delete(e)},_e=()=>(console.log(v.value),A.create(v.value)),$e=async e=>{var g;const a=e===""?"default":e;return((g=(await Oe.searchPersona(a)).data)==null?void 0:g.personas)||[]},be=e=>{c.value.filter(t=>Object.keys(t).some(g=>g===e._id)).length===0?q(e,"New"):w.error("El registro ya fue seleccionado")},q=(e,a)=>{var x,ee;const t=[a==="New"?e:e==null?void 0:e.personaId],g=Pe(t)[0];c.value.push(g);const P={_id:a==="New"?"":e==null?void 0:e._id,projectId:b.value._id,personaId:a==="New"?e._id:(x=e==null?void 0:e.personaId)==null?void 0:x._id,encargado:a==="New"?!1:e==null?void 0:e.encargado,persisteState:a};v.value.push(P),a==="Update"&&(e==null?void 0:e.encargado)&&(s.radio=(ee=e==null?void 0:e.personaId)==null?void 0:ee._id)},Pe=e=>e.map(({_id:a,nombres:p,apellidos:t})=>({[a]:`${p} ${t}`})),je=e=>{const a=s.radio;v.value=v.value.map(p=>(p.encargado=a===p.personaId,p)),console.log(v.value)},Ce=async e=>{const{_id:a}=b.value,p={personaId:Object.keys(e)[0],id:a};await A.delete(p),v.value=[],c.value=[],(await A.read(b.value)).data.personas.map(g=>{q(g,"Update")})};return(e,a)=>{const p=Ve("FormChebckRadioGroup");return f(),E(T,null,[l(ae,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value=t),title:"Please confirm",button:"danger",onConfirm:he,"has-cancel":""},{default:i(()=>[n("strong",null,[K(h(e.$t("message.project.deleted.question"))+" ",1),n("b",null,h(Q()),1)]),K(" ? ")]),_:1},8,["modelValue"]),l(ae,{modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=t=>o.value=t),title:Q(!0),button:"danger",onConfirm:ve,onCancel:Y,"has-cancel":""},{footer:i(()=>[l(k,{label:e.$t("message.submit"),color:"success"},null,8,["label"])]),default:i(()=>[n("div",Ae,[l(W,{label:e.$t("message.project.person")},{default:i(()=>[l(Te,{placeholder:"Buscar...","search-function":$e,"render-function":be,"debounce-time":500},null,8,["placeholder"])]),_:1},8,["label"])]),Re,n("div",Ge,[(f(!0),E(T,null,H(u($),(t,g)=>(f(),V(W,{label:""},{default:i(()=>[l(p,{modelValue:s.radio,"onUpdate:modelValue":a[1]||(a[1]=P=>s.radio=P),name:"sample-radio",type:"radio",isColumn:"true",options:u($)[g],onChange:P=>je(u($)[g])},null,8,["modelValue","options","onChange"]),l(J,{type:"justify-start lg:justify-end","no-wrap":""},{default:i(()=>[l(k,{color:"danger",icon:u(te),small:"",style:{width:"28px",height:"28px"},onClick:P=>Ce(u($)[g])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024))),256))])]),_:1},8,["modelValue","title"]),n("table",null,[n("thead",null,[n("tr",null,[n("th",{onClick:a[3]||(a[3]=t=>O("codigo"))},h(e.$t("message.project.code")),1),n("th",{onClick:a[4]||(a[4]=t=>O("cliente"))},h(e.$t("message.project.client")),1),n("th",{onClick:a[5]||(a[5]=t=>O("socio"))},h(e.$t("message.project.partner")),1),n("th",{onClick:a[6]||(a[6]=t=>O("estado"))},h(e.$t("message.project.status")),1),qe])]),n("tbody",null,[(f(!0),E(T,null,H(u(B),(t,g)=>(f(),E("tr",{key:t._id,onClick:P=>me(t)},[n("td",{"data-label":e.$t("message.project.code")},h(t.codigo),9,Je),n("td",{"data-label":e.$t("message.project.client")},h(t.cliente.nombre),9,Ke),n("td",{"data-label":e.$t("message.project.partner")},h(t.socio.nombres),9,We),n("td",{"data-label":e.$t("message.project.status")},h(e.$t(`message.project.statuses.${L(t.estado)}`)),9,Ze),n("td",ze,[l(J,{type:"justify-start lg:justify-end","no-wrap":""},{default:i(()=>[l(k,{color:"success",icon:u(ce),small:"",onClick:P=>(ge(t),o.value=!0)},null,8,["icon","onClick"]),l(k,{color:"info",icon:u(Ie),small:"",onClick:P=>pe(t._id)},null,8,["icon","onClick"]),Se(l(k,{color:"danger",icon:u(te),small:"",onClick:a[7]||(a[7]=P=>d.value=!0)},null,8,["icon"]),[[De,t.estado!==2]])]),_:2},1024)])],8,He))),128))])]),n("div",Qe,[l(Ue,null,{default:i(()=>[l(J,null,{default:i(()=>[(f(!0),E(T,null,H(u(ue),t=>(f(),V(k,{key:t,active:t===u(C)-1,label:t+1,color:t===u(C)?"lightDark":"whiteDark",small:"",onClick:g=>ie(t+1)},null,8,["active","label","color","onClick"]))),128))]),_:1}),n("small",null,"Page "+h(u(de))+" of "+h(u(z)),1)]),_:1})])],64)}}},na={__name:"IndexView",setup(m){const r=re(),c=_(1),s=_(10),$=le({switch:[]}),v=o=>{Z.index(o).then(d=>{r.projects=d,c.value=d.page,s.value=d.perPage})};v({page:c.value});const I=()=>{F({page:c.value})},w=o=>{F({page:o})},R=(o,d)=>{G({sortBy:o,sortDesc:d})},y=o=>{Z.getDelete(o).then(d=>{r.projects=d,c.value=d.page,s.value=d.perPage})},F=o=>{$.switch.length===0?v({page:o}):y({page:o})},G=(o,d)=>{$.switch.length===0?v({sortBy:o,sortDesc:d}):y({sortBy:o,sortDesc:d})};return(o,d)=>(f(),V(Ee,null,{default:i(()=>[l(Fe,null,{default:i(()=>{var M,C,b,B,L;return[l(se,{icon:u(Me),title:o.$t("message.project.projects")},{default:i(()=>[l(k,{to:"projects/create",icon:u(ce),label:o.$t("message.add_new"),color:"success",small:""},null,8,["icon","label"])]),_:1},8,["icon","title"]),l(W,{label:""},{default:i(()=>[l(Le,{modelValue:$.switch,"onUpdate:modelValue":d[0]||(d[0]=S=>$.switch=S),name:"sample-switch",type:"switch",options:{one:"Mostrar registros eliminados"},onChange:I},null,8,["modelValue"])]),_:1}),(M=u(r))!=null&&M.projects?oe("",!0):(f(),V(se,{key:0,icon:o.mdiTableOff,title:"Empty variation"},null,8,["icon"])),(C=u(r))!=null&&C.projects?oe("",!0):(f(),V(Ne,{key:1,color:"danger",icon:o.mdiTableOff},{default:i(()=>[n("b",null,h(o.$t("message.empty_table"))+".",1),K(" When there's nothing to show ")]),_:1},8,["icon"])),(L=(B=(b=u(r))==null?void 0:b.projects)==null?void 0:B.proyectos)!=null&&L.length?(f(),V(ne,{key:2,class:"mb-6","has-table":""},{default:i(()=>[l(Xe,{onChangePage:w,onSort:R})]),_:1})):(f(),V(ne,{key:3},{default:i(()=>[l(Be)]),_:1}))]}),_:1})]),_:1}))}};export{na as default};
