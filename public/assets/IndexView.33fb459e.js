import{ar as S,as as T,y as _,x as ne,I as j,ag as Ce,ah as ke,aa as Ve,S as le,o as f,r as D,a as c,w as p,j as n,f as Q,E as h,$ as ee,d as k,B as R,K as F,L as G,u as l,c as V,A as K,al as ae,aq as re,ak as Ie,M as Se,aj as Te,T as De,_ as Ue,b as se,Q as te,e as Ee,g as oe,i as Me,ap as Ne}from"./index.e27aaed2.js";import{C as Be}from"./CardBoxComponentEmpty.8b08f16b.js";import{_ as ce}from"./FormCheckRadioGroup.84cb26fc.js";import{p as W}from"./projects.service.f058dcd0.js";import{p as Le}from"./personal.service.ad7206b3.js";import{A as Fe}from"./Autocomplete.fb8cd81c.js";import"./FormCheckRadio.44135d25.js";const U="api/personasProyectos/",A={create(g){return new Promise((d,r)=>{S.post(U,g,{headers:T()}).then(t=>d(t)).catch(t=>r(t))})},read(g){return new Promise((d,r)=>{S.get(`${U}/${g._id}`,{headers:T()}).then(t=>{d(t)}).catch(t=>r(t))})},update(g){return new Promise((d,r)=>{S.put(`${U}/${g._id}`,g,{headers:T()}).then(t=>d(t.data)).catch(t=>r(t))})},delete(g){return new Promise((d,r)=>{S.delete(`${U}${g.id}/${g.personaId}`,{headers:T()}).then(t=>d(t.data)).catch(t=>r(t))})},restore(g){return new Promise((d,r)=>{S.delete(`${U}/restore/${g}`,{headers:T()}).then(t=>d(t.data)).catch(t=>r(t))})}},Ae={class:"grid md:grid-cols-1 gap-1"},Oe=n("div",{class:"grid md:grid-cols-1 gap-1"},[n("h2",null," Encargado ")],-1),qe={class:"grid md:grid-cols-1 gap-1"},He=n("th",null,null,-1),Ge=["onClick"],Ke=["data-label"],Qe=["data-label"],Re=["data-label"],We=["data-label"],ze={class:"before:hidden lg:w-1 whitespace-nowrap"},Je={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Xe={__name:"ProjectTable.view",props:{checkable:Boolean},emits:["changePage","confirm","sort"],setup(g,{emit:d}){let r=_([]);const t=ne({radio:[]}),$=j(()=>r.value),v=_([]),{t:b}=Ce(),y=ke(),O=Ve(),C=le(),E=j(()=>C.projects.proyectos),q=j(()=>C.projects.total);_(!1);const o=_(!1),u=_(!1),M=j(()=>C.projects.perPage),w=j(()=>C.projects.page);_([]);const P=_([]),N=j(()=>E.value),B=(e="")=>({0:"inactive",1:"active",2:"deleted"})[e],I=_(!1),L=e=>{I.value=!I.value,d("sort",e,I.value)},z=j(()=>Math.ceil(q.value/M.value)),de=j(()=>+w.value),ue=j(()=>{const e=[];for(let a=0;a<z.value;a++)e.push(a);return e}),ie=e=>{d("changePage",e)},pe=e=>{O.push({name:"ProjectsUpdate",params:{id:e}})},ge=async e=>{Y(),(await A.read(e)).data.personas.map(s=>{H(s,"Update")})},me=e=>P.value=e,J=(e=!1)=>{const{codigo:a}=P.value;return e?`${b("message.project.project")} ${a}`:a},X=b("message.project.deleted.success"),he=async()=>{fe().then(()=>{y.success(X),d("changePage",w.value)}).catch(e=>{var a;y.error(`${b("message.project.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},ve=async()=>{_e().then(()=>{y.success(X),d("changePage",w.value)}).catch(e=>{var a;y.error(`${b("message.project.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},Y=()=>{r.value=[],v.value=[]},fe=()=>{const{_id:e}=P.value;return W.delete(e)},_e=()=>(console.log(v.value),A.create(v.value)),$e=async e=>{var i;const a=e===""?"default":e;return((i=(await Le.searchPersona(a)).data)==null?void 0:i.personas)||[]},be=e=>{console.log(r.value),r.value.filter(m=>Object.keys(m).some(i=>i===e._id)).length===0?H(e,"New"):y.error("El registro ya fue seleccionado")},H=(e,a)=>{var Z,x;const m=[a==="New"?e:e==null?void 0:e.personaId],i=Pe(m)[0];r.value.push(i);const ye={_id:a==="New"?"":e==null?void 0:e._id,projectId:P.value._id,personaId:a==="New"?e._id:(Z=e==null?void 0:e.personaId)==null?void 0:Z._id,encargado:a==="New"?!1:e==null?void 0:e.encargado,persisteState:a};v.value.push(ye),a==="Update"&&(e==null?void 0:e.encargado)&&(t.radio=(x=e==null?void 0:e.personaId)==null?void 0:x._id)},Pe=e=>e.map(({_id:a,nombres:s,apellidos:m})=>({[a]:`${s} ${m}`})),je=e=>{const a=t.radio;v.value=v.value.map(s=>(s.encargado=a===s.personaId,s)),console.log(v.value)},we=async e=>{const{_id:a}=P.value,s={personaId:Object.keys(e)[0],id:a};await A.delete(s),v.value=[],r.value=[],(await A.read(P.value)).data.personas.map(i=>{H(i,"Update")})};return(e,a)=>(f(),D(F,null,[c(ee,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=s=>u.value=s),title:"Please confirm",button:"danger",onConfirm:he,"has-cancel":""},{default:p(()=>[n("strong",null,[Q(h(e.$t("message.project.deleted.question"))+" ",1),n("b",null,h(J()),1)]),Q(" ? ")]),_:1},8,["modelValue"]),c(ee,{modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=s=>o.value=s),title:J(!0),button:"danger",onConfirm:ve,onCancel:Y,"has-cancel":""},{footer:p(()=>[c(k,{label:e.$t("message.submit"),color:"success"},null,8,["label"])]),default:p(()=>[n("div",Ae,[c(R,{label:e.$t("message.project.person")},{default:p(()=>[c(Fe,{placeholder:"Buscar...","search-function":$e,"render-function":be,"debounce-time":500},null,8,["placeholder"])]),_:1},8,["label"])]),Oe,n("div",qe,[(f(!0),D(F,null,G(l($),(s,m)=>(f(),V(R,{label:""},{default:p(()=>[c(ce,{modelValue:t.radio,"onUpdate:modelValue":a[1]||(a[1]=i=>t.radio=i),name:"sample-radio",type:"radio",isColumn:"true",options:l($)[m],onChange:i=>je(l($)[m])},null,8,["modelValue","options","onChange"]),c(K,{type:"justify-start lg:justify-end","no-wrap":""},{default:p(()=>[c(k,{color:"danger",icon:l(ae),small:"",style:{width:"28px",height:"28px"},onClick:i=>we(l($)[m])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024))),256))])]),_:1},8,["modelValue","title"]),n("table",null,[n("thead",null,[n("tr",null,[n("th",{onClick:a[3]||(a[3]=s=>L("codigo"))},h(e.$t("message.project.code")),1),n("th",{onClick:a[4]||(a[4]=s=>L("cliente"))},h(e.$t("message.project.client")),1),n("th",{onClick:a[5]||(a[5]=s=>L("socio"))},h(e.$t("message.project.partner")),1),n("th",{onClick:a[6]||(a[6]=s=>L("estado"))},h(e.$t("message.project.status")),1),He])]),n("tbody",null,[(f(!0),D(F,null,G(l(N),(s,m)=>(f(),D("tr",{key:s._id,onClick:i=>me(s)},[n("td",{"data-label":e.$t("message.project.code")},h(s.codigo),9,Ke),n("td",{"data-label":e.$t("message.project.client")},h(s.cliente.nombre),9,Qe),n("td",{"data-label":e.$t("message.project.partner")},h(s.socio.nombres),9,Re),n("td",{"data-label":e.$t("message.project.status")},h(e.$t(`message.project.statuses.${B(s.estado)}`)),9,We),n("td",ze,[c(K,{type:"justify-start lg:justify-end","no-wrap":""},{default:p(()=>[c(k,{color:"success",icon:l(re),messageTooltip:l(b)("message.assignPerson"),small:"",onClick:i=>(ge(s),o.value=!0)},null,8,["icon","messageTooltip","onClick"]),c(k,{color:"info",icon:l(Ie),messageTooltip:l(b)("message.edit"),small:"",onClick:i=>pe(s._id)},null,8,["icon","messageTooltip","onClick"]),Se(c(k,{color:"danger",icon:l(ae),messageTooltip:l(b)("message.delete"),small:"",onClick:a[7]||(a[7]=i=>u.value=!0)},null,8,["icon","messageTooltip"]),[[Te,s.estado!==2]])]),_:2},1024)])],8,Ge))),128))])]),n("div",Je,[c(De,null,{default:p(()=>[c(K,null,{default:p(()=>[(f(!0),D(F,null,G(l(ue),s=>(f(),V(k,{key:s,active:s===l(w)-1,label:s+1,color:s===l(w)?"lightDark":"whiteDark",small:"",onClick:m=>ie(s+1)},null,8,["active","label","color","onClick"]))),128))]),_:1}),n("small",null,"Page "+h(l(de))+" of "+h(l(z)),1)]),_:1})])],64))}},oa={__name:"IndexView",setup(g){const d=le(),r=_(1),t=_(10),$=ne({switch:[]}),v=o=>{W.index(o).then(u=>{d.projects=u,r.value=u.page,t.value=u.perPage})};v({page:r.value});const b=()=>{E({page:r.value})},y=o=>{E({page:o})},O=(o,u)=>{q({sortBy:o,sortDesc:u})},C=o=>{W.getDelete(o).then(u=>{d.projects=u,r.value=u.page,t.value=u.perPage})},E=o=>{$.switch.length===0?v({page:o}):C({page:o})},q=o=>{$.switch.length===0?v(o):C(o)};return(o,u)=>(f(),V(Ue,null,{default:p(()=>[c(Me,null,{default:p(()=>{var M,w,P,N,B;return[c(se,{icon:l(Ne),title:o.$t("message.project.projects")},{default:p(()=>[c(k,{to:"projects/create",icon:l(re),label:o.$t("message.add_new"),color:"success",small:""},null,8,["icon","label"])]),_:1},8,["icon","title"]),c(R,{label:""},{default:p(()=>[c(ce,{modelValue:$.switch,"onUpdate:modelValue":u[0]||(u[0]=I=>$.switch=I),name:"sample-switch",type:"switch",options:{one:"Mostrar registros eliminados"},onChange:b},null,8,["modelValue"])]),_:1}),(M=l(d))!=null&&M.projects?te("",!0):(f(),V(se,{key:0,icon:o.mdiTableOff,title:"Empty variation"},null,8,["icon"])),(w=l(d))!=null&&w.projects?te("",!0):(f(),V(Ee,{key:1,color:"danger",icon:o.mdiTableOff},{default:p(()=>[n("b",null,h(o.$t("message.empty_table"))+".",1),Q(" When there's nothing to show ")]),_:1},8,["icon"])),(B=(N=(P=l(d))==null?void 0:P.projects)==null?void 0:N.proyectos)!=null&&B.length?(f(),V(oe,{key:2,class:"mb-6","has-table":""},{default:p(()=>[c(Xe,{onChangePage:y,onSort:O})]),_:1})):(f(),V(oe,{key:3},{default:p(()=>[c(Be)]),_:1}))]}),_:1})]),_:1}))}};export{oa as default};
