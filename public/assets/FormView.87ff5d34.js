import{as as B,at as A,u as De,ak as Pe,au as _e,ae as Oe,r as w,aL as Y,g as Ye,ax as je,P as Be,o as le,c as Ae,a as d,b as v,d as D,i as o,S as j,N as Ie,_ as m,p as t,ay as Te,ar as P,az as $,h as de,m as ue,j as Ne,an as Ee,ao as Re}from"./index.cc1855cb.js";import{r as re,u as We}from"./index.esm.b52ce059.js";import{b as Ge,a as oe,_ as qe}from"./BaseButton.00025e8c.js";import{_ as r}from"./FormField.c25f55fc.js";import{c as ze}from"./cities.service.4e261c34.js";import{a as He}from"./allies.service.4a292ada.js";import{c as Je}from"./cargos.service.b567f2a2.js";import{s as Ke}from"./states.services.9fb68361.js";import{m as se}from"./member.service.4a696792.js";import{T as Qe}from"./TabsComponent.7dba70eb.js";import{c as Xe}from"./countries.service.347a35f9.js";const T="api/membresiaLicencias",q={getLicencia(b){return new Promise((g,i)=>{B.get(`${T}/licencia/${b}`,{headers:A()}).then(n=>g(n.data)).catch(n=>i(n))})},create(b){return new Promise((g,i)=>{B.post(T,b,{headers:A()}).then(n=>g(n)).catch(n=>i(n))})},update(b){return new Promise((g,i)=>{B.put(`${T}/${b._id}`,b,{headers:A()}).then(n=>g(n.data)).catch(n=>i(n))})},restore(b){return new Promise((g,i)=>{B.delete(`${T}/restore/${b}`,{headers:A()}).then(n=>g(n.data)).catch(n=>i(n))})},delete(b){return new Promise((g,i)=>{B.delete(`${T}/${b}`,{headers:A()}).then(n=>g(n.data)).catch(n=>i(n))})}},Ze="api/planes",xe={index(){return new Promise((b,g)=>{B.get(Ze,{},{headers:A()}).then(i=>b(i.data)).catch(i=>g(i))})}};const ea=b=>(Ee("data-v-b09cfb4d"),b=b(),Re(),b),aa={class:"container mx-auto"},la={class:"p-1 mt-0 bg-white border"},oa={class:"grid md:grid-cols-3 gap-3"},sa={class:"grid md:grid-cols-2 gap-2"},ta={class:"grid md:grid-cols-3 gap-3"},ia={class:"grid md:grid-cols-3 gap-3"},na={class:"grid md:grid-cols-1 gap-1"},da={class:"grid md:grid-cols-3 gap-3"},ua={style:{display:"flex","flex-direction":"row"}},ra={class:"grid grid-cols-1 gap-3",style:{width:"40%"}},ma={class:"grid grid-cols-1 gap-3",style:{"padding-left":"20px",position:"relative"}},ca={class:"grid gap-1",style:{position:"relative",padding:"10px 0px 2px"}},pa={style:{display:"flex","flex-direction":"row",gap:"10px",padding:"5px 0px 0 10px"}},ba=ea(()=>v("div",null,null,-1)),va={style:{display:"flex","justify-content":"space-between"}},ga={__name:"FormView",props:{path:"",saveLabel:"",state:{}},setup(b){const g=b,{t:i}=De(),n=Pe(),me=_e(),ce=Oe();let I=w("create");w([]);let z=w([]),N=w([]),E=w([]),H=w([]);w([]);let J=w([]),K=w([]),L=w(!0);const _=w(0),pe=a=>{_.value=a},be=[{title:"Membresia"},{title:"Contacto"},{title:"Users"},{title:"Licences"}],Q=[{id:1,label:i("message.cargo.statuses.active")},{id:0,label:i("message.cargo.statuses.inactive")}],X=[{id:1,label:i("message.member.administrative_contacts")},{id:2,label:i("message.member.technology_contacts")}],ve=[{id:1,label:i("message.member.yes")},{id:2,label:i("message.member.no")}];w({date:"DD-MM-YYYY",month:"MMM"});const y=w({_id:"",firstname:"",lastname:"",username:"",email:"",password:"",avatar:"",role:"ADMIN_ROLE",estadoMembresia:1,google:!1}),f=w({_id:"",fechaActual:Y(),fechaFinal:Y(),membresia:"",licencia:"",plan:{}}),s=w({_id:"",aliado:J.value,codigo:"00",nombre:"",iDFiscal:"",ejercicioFiscal:"",pais:z.value,state:N.value,ciudad:E.value,calle:"",paginaWeb:"",tipoContacto:X[0],nombreContact:"",apellidoContact:"",cargo:H.value,telefonoOfic:"",telefonoCelu:"",correoContact:"",plan:K.value,estado:Q[0]}),ge=Ye(()=>({nombre:{required:re},iDFiscal:{required:re}})),Z=We(ge,s);je(async()=>{var h,l;let a=await Xe.index();const e=(a==null?void 0:a.paises)||[];z.value=e.map(c=>({id:c._id,label:c.nombre}));let p=await Je.allCargos();const u=p==null?void 0:p.data.cargos;H.value=u.map(c=>({id:c._id,label:c.nombre}));let V=await He.allAliadosGet();const C=V==null?void 0:V.data.aliados;J.value=C.map(c=>({id:c._id,label:c.nombre}));let U=await xe.index();const k=U==null?void 0:U.planes;if(K.value=k.map(c=>({id:c._id,label:c.descripcion,dias:c.dias})),g.path==="update"){const c=await se.read(me.params);s.value=c.data.miembro;const{_id:O,cargo:W,aliado:G,moneda:ne,estado:x,tipoContacto:ee,creacion:ae}=c.data.miembro,S=await q.getLicencia(O);console.log(S);const M=((h=S.data)==null?void 0:h.licencia)||{};if(Object.keys(M).length===0)S!=null&&S.msj&&n.error(`${S==null?void 0:S.msj}`),s.value.plan=[],L.value=!1;else{L.value=!0;const ke={...R(M==null?void 0:M.plan),dias:M==null?void 0:M.plan.dias};s.value.plan=ke,f.value=M}f.value.membresia=O,s.value.cargo={id:W._id,label:W.nombre},s.value.aliado={id:G._id,label:G.nombre},s.value.pais=R((l=c.data)==null?void 0:l.miembro.pais),s.value.estado=Q.filter(F=>F.id===x)[0],s.value.tipoContacto=X.filter(F=>F.id===ee)[0],s.value.creacion=ve.filter(F=>F.id===ae)[0],te(s.value.pais,c.data.miembro),c.data.userMiembro&&(console.log(c.data.userMiembro),y.value=c.data.userMiembro,y.value.password=c.data.password)}});const R=a=>(console.log(a),{id:a._id,label:(a==null?void 0:a.nombre)||(a==null?void 0:a.descripcion)}),te=(a,e={})=>{const{id:p}=a;E.value=[],N.value=[],fe(p).then(u=>{const V=(u==null?void 0:u.estados)||[];N.value=V.map(C=>({id:C._id,label:C.nombre})),g.path==="update"&&(s.value.state=R(e==null?void 0:e.state),ie(s.value.state,e==null?void 0:e.ciudad))}).catch(u=>{console.log(u)})},fe=async a=>await Ke.estadosByPais(a),ie=(a,e={})=>{const{id:p}=a;Ve(p).then(u=>{const V=(u==null?void 0:u.ciudades)||[];E.value=V.map(C=>({id:C._id,label:C.nombre})),g.path==="update"&&(s.value.ciudad=R(e))}).catch(u=>{console.log(u)})},Ve=async a=>await ze.ciudadesByEstados(a),$e=a=>{const{_id:e,aliado:p,codigo:u,nombre:V,iDFiscal:C,ejercicioFiscal:U,pais:k,state:h,ciudad:l,calle:c,paginaWeb:O,tipoContacto:W,nombreContact:G,apellidoContact:ne,cargo:x,telefonoOfic:ee,telefonoCelu:ae,correoContact:S,estado:M}=a.value;console.log(y.value);const F={_id:e,aliado:p.id,codigo:u,nombre:V,iDFiscal:C,ejercicioFiscal:U,pais:k.id,state:h.id,ciudad:l.id,calle:c,paginaWeb:O,tipoContacto:W.id,nombreContact:G,apellidoContact:ne,cargo:x.id,telefonoOfic:ee,telefonoCelu:ae,correoContact:S,membresiaUsuario:y.value,estado:M.id};return console.log(F),g.path==="create"?se.create(F):se.update(F)},ye=g.path==="create"?i("message.member.created.success"):i("message.member.updated.success"),Ce=g.path==="create"?i("message.member.created.error"):i("message.member.updated.error"),we=async()=>{L.value=!0,await Z.value.$validate()?$e(s).then(()=>{g.path==="create"&&(L.value=!1),n.success(ye)}).catch(e=>{var p,u,V;if((u=(p=e.response)==null?void 0:p.data)!=null&&u.msg){n.error(`${Ce} ${e.response.data.msg}`);return}if((V=e.response.data)!=null&&V.errors){const C=e.response.data.errors;for(let U of C);}}):console.log("error")},he=()=>ce.push("/setup/memberships"),Le=a=>{const{id:e,dias:p}=a,u=Y().utc(),V=Y().utc().add(p,"days");f.value.fechaActual=u.format("YYYY-MM-DD"),f.value.fechaFinal=V.format("YYYY-MM-DD"),f.value.plan=a},Ue=async()=>{const a=f.value.plan,e=i("message.member.youmustselectaplan");if(Object.keys(a).length===0)n.error(`${e}`);else{const{_id:p,fechaActual:u,fechaFinal:V,plan:C,membresia:U}=f.value,k={_id:p,fechaActual:u,fechaFinal:V,plan:C,membresia:U};try{let h=null,l="";I.value!=="update"&&f.value.licencia===""?(l=i("message.member.thelicensewassuccessfullygenerated"),h=await q.create(k)):(l=i("message.member.updated.successlicense"),h=await q.update(k));const{_id:c,licencia:O}=h==null?void 0:h.data;f.value.licencia=O,f.value._id=c,L.value=!0,I.value="create",n.success(l)}catch{if(I.value!=="update")n.error("Error al generar la licencia");else{const l=i("message.member.updated.errorlicense");n.error(l)}I.value="create"}}},Se=()=>{if(console.log("copia"),L.value){const a=document.getElementById("txtLiencia");a.select(),a.setSelectionRange(0,99999),document.execCommand("copy");const e=i("message.member.successfullycopiedlicense");n.success(e)}else{const a=i("message.member.noactivelicense");n.error(a)}},Me=async()=>{const{_id:a}=f.value;if(L.value)try{const e=a,p=await q.delete(e),u=i("message.member.deleted.successLicense");n.success(u),s.value.plan=[],f.value.id="",f.value.fechaActual=Y(),f.value.fechaFinal=Y(),f.value.licencia="",f.value.plan={},L.value=!1}catch{const p=i("message.member.deleted.errorLicense");n.error(p)}else{const e="No hay licencia para eliminar";n.error(e)}},Fe=()=>{I.value="update",console.log(f.value),L.value=!1};return(a,e)=>{const p=Be("tippy");return le(),Ae(qe,{isForm:"",onSubmit:Ne(we,["prevent"])},{footer:d(()=>[v("div",va,[D(o(oe,{label:a.$t(`message.${g.saveLabel}`),type:"submit",color:"success"},null,8,["label"]),[[j,_.value===2]]),o(oe,{label:a.$t("message.return"),color:"info",onClick:e[30]||(e[30]=u=>he())},null,8,["label"])])]),default:d(()=>[v("div",null,[v("div",aa,[o(Qe,{tabs:be,onTabClick:pe},{default:d(()=>{var u,V,C,U,k,h;return[v("div",la,[D(v("div",null,[v("div",{class:Ie(b.path!=="create"?"grid md:grid-cols-3 gap-3":"grid md:grid-cols-2 gap-3")},[D(o(r,{label:a.$t("message.member.code")},{default:d(()=>[o(m,{name:"codigo",modelValue:s.value.codigo,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.codigo=l),icon:t(Te),readonly:"true"},null,8,["modelValue","icon"])]),_:1},8,["label"]),[[j,b.path!=="create"]]),o(r,{label:a.$t("message.member.ally")},{default:d(()=>[o(m,{modelValue:s.value.aliado,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.aliado=l),icon:t(P),options:t(J)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.name"),help:(C=(V=(u=t(Z))==null?void 0:u.nombre)==null?void 0:V.$errors[0])==null?void 0:C.$message},{default:d(()=>[o(m,{modelValue:s.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.nombre=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label","help"])],2),v("div",oa,[o(r,{label:a.$t("message.member.idFiscal"),help:(h=(k=(U=t(Z))==null?void 0:U.iDFiscal)==null?void 0:k.$errors[0])==null?void 0:h.$message},{default:d(()=>[o(m,{modelValue:s.value.iDFiscal,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.iDFiscal=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),o(r,{label:a.$t("message.member.f\xEDscal_year")},{default:d(()=>[o(m,{modelValue:s.value.ejercicioFiscal,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.ejercicioFiscal=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.country")},{default:d(()=>[o(m,{modelValue:s.value.pais,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.pais=l),icon:t(P),options:t(z),onOnSelectChange:te},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.state")},{default:d(()=>[o(m,{modelValue:s.value.state,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.state=l),icon:t(P),options:t(N),onOnSelectChange:ie},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.city")},{default:d(()=>[o(m,{modelValue:s.value.ciudad,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.ciudad=l),icon:t(P),options:t(E)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.street")},{default:d(()=>[o(m,{modelValue:s.value.calle,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.calle=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),v("div",sa,[o(r,{label:a.$t("message.member.paginaWeb")},{default:d(()=>[o(m,{modelValue:s.value.paginaWeb,"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.paginaWeb=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.status")},{default:d(()=>[o(m,{modelValue:s.value.estado,"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.estado=l),icon:t(P),options:Q},null,8,["modelValue","icon"])]),_:1},8,["label"])])],512),[[j,_.value===0]]),D(v("div",null,[v("div",ta,[o(r,{label:a.$t("message.member.type_contacts")},{default:d(()=>[o(m,{modelValue:s.value.tipoContacto,"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.tipoContacto=l),icon:t(P),options:X},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.name")},{default:d(()=>[o(m,{modelValue:s.value.nombreContact,"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.nombreContact=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.lastName")},{default:d(()=>[o(m,{modelValue:s.value.apellidoContact,"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.apellidoContact=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),v("div",ia,[o(r,{label:a.$t("message.member.cargo")},{default:d(()=>[o(m,{modelValue:s.value.cargo,"onUpdate:modelValue":e[14]||(e[14]=l=>s.value.cargo=l),icon:t(P),options:t(H)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.officePhone")},{default:d(()=>[o(m,{modelValue:s.value.telefonoOfic,"onUpdate:modelValue":e[15]||(e[15]=l=>s.value.telefonoOfic=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.member.movilPhone")},{default:d(()=>[o(m,{modelValue:s.value.telefonoCelu,"onUpdate:modelValue":e[16]||(e[16]=l=>s.value.telefonoCelu=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),v("div",na,[o(r,{label:a.$t("message.member.email")},{default:d(()=>[o(m,{modelValue:s.value.correoContact,"onUpdate:modelValue":e[17]||(e[17]=l=>s.value.correoContact=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"])])],512),[[j,_.value===1]]),D(v("div",null,[v("div",da,[o(r,{label:a.$t("message.user.firstname")},{default:d(()=>[o(m,{modelValue:y.value.firstname,"onUpdate:modelValue":e[18]||(e[18]=l=>y.value.firstname=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.user.lastname")},{default:d(()=>[o(m,{modelValue:y.value.lastname,"onUpdate:modelValue":e[19]||(e[19]=l=>y.value.lastname=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.user.username")},{default:d(()=>[o(m,{modelValue:y.value.username,"onUpdate:modelValue":e[20]||(e[20]=l=>y.value.username=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.user.email")},{default:d(()=>[o(m,{modelValue:y.value.email,"onUpdate:modelValue":e[21]||(e[21]=l=>y.value.email=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.user.password")},{default:d(()=>[o(m,{modelValue:y.value.password,"onUpdate:modelValue":e[22]||(e[22]=l=>y.value.password=l),icon:t($)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(r,{label:a.$t("message.user.role")},{default:d(()=>[o(m,{modelValue:y.value.role,"onUpdate:modelValue":e[23]||(e[23]=l=>y.value.role=l),icon:t($),readonly:"true"},null,8,["modelValue","icon"])]),_:1},8,["label"])])],512),[[j,_.value===2]]),D(v("div",null,[v("div",ua,[v("div",ra,[o(r,{label:a.$t("message.member.plan")},{default:d(()=>[o(m,{modelValue:s.value.plan,"onUpdate:modelValue":e[24]||(e[24]=l=>s.value.plan=l),icon:t(P),options:t(K),onOnSelectChange:Le,readonly:t(L)},null,8,["modelValue","icon","options","readonly"])]),_:1},8,["label"])]),v("div",ma,[o(r,{label:""},{default:d(()=>[o(oe,{label:a.$t("message.generateLicense"),color:"succes",disabled:t(L),class:"generateLicence",onClick:e[25]||(e[25]=l=>Ue())},null,8,["label","disabled"])]),_:1})])]),v("div",ca,[o(r,{label:a.$t("message.member.license"),style:{"margin-bottom":"0px"}},{default:d(()=>[o(m,{type:"textarea",modelValue:f.value.licencia,"onUpdate:modelValue":e[26]||(e[26]=l=>f.value.licencia=l),icon:t($),id:"txtLiencia",readonly:!0},null,8,["modelValue","icon"])]),_:1},8,["label"]),v("div",pa,[D(v("i",{class:"fas fa-copy icon-licencia",onClick:e[27]||(e[27]=l=>Se())},null,512),[[p,{content:a.$t("message.member.copyLicense")}]]),b.path!=="create"?D((le(),de("i",{key:0,class:"fa-solid fa-pen-to-square icon-licencia",onClick:e[28]||(e[28]=l=>Fe())},null,512)),[[p,{content:a.$t("message.member.modifyLicense")}]]):ue("",!0),b.path!=="create"?D((le(),de("i",{key:1,class:"fa-solid fa-trash icon-licencia",onClick:e[29]||(e[29]=l=>Me())},null,512)),[[p,{content:a.$t("message.member.deleteLicense")}]]):ue("",!0)])])],512),[[j,_.value===3]]),ba])]}),_:1})])])]),_:1},8,["onSubmit"])}}},Fa=Ge(ga,[["__scopeId","data-v-b09cfb4d"]]);export{Fa as F};
