import{y as g,ag as ie,ah as ce,aa as de,S as ae,I as $,o as u,r as T,j as l,E as p,K,L as X,a as r,w as i,M as ue,d as Q,u as c,aO as me,aj as pe,A as Z,c as f,T as ge,aK as oe,q as ve,x as fe,aJ as be,_ as he,b as x,ao as _e,g as z,z as $e,B as F,Q as D,C as G,e as ye,f as ke,i as Pe,ap as Ce,av as H}from"./index.e27aaed2.js";import{C as je}from"./CardBoxComponentEmpty.8b08f16b.js";import{p as ee}from"./projects.service.f058dcd0.js";import{A as te}from"./Autocomplete.fb8cd81c.js";import{c as we}from"./clients.srvice.5f8d7b0a.js";import{p as Ve}from"./personal.service.ad7206b3.js";const Fe=l("th",null,null,-1),De=["onClick"],Se=["data-label"],Ie=["data-label"],Le=["data-label"],Me=["data-label"],Be=["data-label"],Te={class:"before:hidden lg:w-1 whitespace-nowrap"},Ye={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Ee={__name:"ProjectTableView",emits:["changePage","confirm","sort"],setup(se,{emit:h}){g([]);const{t:y}=ie();ce();const L=de(),V=ae(),Y=$(()=>V.projects.proyectos),k=$(()=>V.projects.total),P=$(()=>V.projects.perPage),b=$(()=>V.projects.page),C=g([]),E=$(()=>Y.value),O=(a="")=>({0:"inactive",1:"active",2:"deleted"})[a],s=g(!1),j=a=>{s.value=!s.value,h("sort",a,s.value)},_=$(()=>Math.ceil(k.value/P.value)),A=$(()=>+b.value),U=$(()=>{const a=[];for(let n=0;n<_.value;n++)a.push(n);return a}),M=a=>{h("changePage",a)},N=a=>C.value=a,q=(a,n)=>oe(a).format(n),J=a=>{const{codigo:n,sucursal:o,_id:S}=a,{nombre:I}=o;localStorage.setItem("selectedProject",JSON.stringify(a)),L.push({name:"AuditApproach",params:{codigo:n,nombre:I,_id:S}})};return(a,n)=>(u(),T(K,null,[l("table",null,[l("thead",null,[l("tr",null,[l("th",{onClick:n[0]||(n[0]=o=>j("codigo"))},p(a.$t("message.project.code")),1),l("th",{onClick:n[1]||(n[1]=o=>j("cliente"))},p(a.$t("message.project.client")),1),l("th",{onClick:n[2]||(n[2]=o=>j("socio"))},p(a.$t("message.project.partner")),1),l("th",null,p(a.$t("message.project.date")),1),l("th",{onClick:n[3]||(n[3]=o=>j("estado"))},p(a.$t("message.project.status")),1),Fe])]),l("tbody",null,[(u(!0),T(K,null,X(c(E),(o,S)=>(u(),T("tr",{key:o._id,onClick:I=>N(o)},[l("td",{"data-label":a.$t("message.project.code")},p(o.codigo),9,Se),l("td",{"data-label":a.$t("message.project.client")},p(o.cliente.nombre),9,Ie),l("td",{"data-label":a.$t("message.project.partner")},p(o.socio.nombres),9,Le),l("td",{"data-label":a.$t("message.project.date")},p(q(o.fecha,"DD/MM/YYYY")),9,Me),l("td",{"data-label":a.$t("message.project.status")},p(a.$t(`message.project.statuses.${O(o.estado)}`)),9,Be),l("td",Te,[r(Z,null,{default:i(()=>[ue(r(Q,{color:"info",icon:c(me),messageTooltip:c(y)("message.redirect"),small:"",onClick:I=>J(o)},null,8,["icon","messageTooltip","onClick"]),[[pe,o.estado!==2]])]),_:2},1024)])],8,De))),128))])]),l("div",Ye,[r(ge,null,{default:i(()=>[r(Z,null,{default:i(()=>[(u(!0),T(K,null,X(c(U),o=>(u(),f(Q,{key:o,active:o===c(b)-1,label:o+1,color:o===c(b)?"lightDark":"whiteDark",small:"",onClick:S=>M(o+1)},null,8,["active","label","color","onClick"]))),128))]),_:1}),l("small",null,"Page "+p(c(A))+" of "+p(c(_)),1)]),_:1})])],64))}};const Oe={class:"grid md:grid-cols-2 gap-4"},Ae={__name:"IndexView",props:{path:"",saveLabel:"",project:{}},setup(se){const h=ae(),y=g(1),L=g(10);let V=g([]),Y=g([]);const k=g(!0),P=g(!1),b=g(!0),C=g(!1),E=g([{name:"Inicio"}]),O=e=>{const t=e.getDate(),v=e.getMonth()+1,m=e.getFullYear();return`${t}/${v}/${m}`},s=g({cliente:"",idCliente:"",codigo:"",fecha:null,persona:"",idPersona:""}),j=fe({switch:[]}),_=e=>{ee.index(e).then(t=>{h.projects=t,y.value=t.page,L.value=t.perPage})};_({page:y.value});const A=e=>{N({page:e})},U=(e,t)=>{q({sortBy:e,sortDesc:t})},M=e=>{ee.getDelete(e).then(t=>{h.projects=t,y.value=t.page,L.value=t.perPage})},N=e=>{j.switch.length===0?_({page:e}):M({page:e})},q=(e,t)=>{j.switch.length===0?_({sortBy:e,sortDesc:t}):M({sortBy:e,sortDesc:t})},J=async e=>{var d;const t=e===""?"default":e;return((d=(await we.searchCliente(t)).data)==null?void 0:d.clientes)||[]},a=e=>{Y.value.filter(m=>Object.keys(m).some(d=>d===e._id)).length===0?n(e):toast.error("El registro ya fue seleccionado")},n=(e,t)=>{s.value.cliente=e.nombreCompleto,s.value.idCliente=e.id,k.value=!k.value,P.value=!P.value},o=(e,t)=>{s.value.persona=e.nombreCompleto,s.value.idPersona=e.id,b.value=!b.value,C.value=!C.value},S=async e=>{var d;const t=e===""?"default":e;return((d=(await Ve.searchPersona(t)).data)==null?void 0:d.personas)||[]},I=e=>{V.value.filter(m=>Object.keys(m).some(d=>d===e._id)).length===0?o(e):toast.error("El registro ya fue seleccionado")},le=()=>{P.value=!P.value,k.value=!k.value,s.value.cliente="",s.value.idCliente=""},ne=()=>{b.value=!b.value,C.value=!C.value,s.value.persona="",s.value.idPersona=""},re=()=>{const{idCliente:e,fecha:t,codigo:v,idPersona:m}=s.value,d=t===null?"":oe(t).format("YYYY-MM-DD");if(e===""&&t===null&&v===""&&m==="")_({page:y.value});else{const B=[{codigo:v,fecha:d,cliente:e,socio:m}];_({page:y.value,q:B})}};return(e,t)=>{const v=be("VueDatePicker");return u(),f(he,null,{default:i(()=>[r(Pe,null,{default:i(()=>{var m,d,B,R,W;return[r(x,{icon:c(Ce),title:e.$t("message.project.papers")},null,8,["icon","title"]),r(_e,{items:E.value},null,8,["items"]),r(z,{isForm:"",onSubmit:$e(e.submit,["prevent"]),style:{background:"rgb(134 134 145 / 16%)"}},{footer:i(()=>[r(Q,{label:e.$t("message.search"),color:"success",onClick:re},null,8,["label"])]),default:i(()=>[l("div",Oe,[k.value?(u(),f(F,{key:0,label:e.$t("message.project.client"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(te,{placeholder:"Buscar...","search-function":J,"render-function":a,"debounce-time":500},null,8,["placeholder"])]),_:1},8,["label"])):D("",!0),P.value?(u(),f(F,{key:1,label:e.$t("message.project.client"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(G,{name:"name",modelValue:s.value.cliente,"onUpdate:modelValue":t[0]||(t[0]=w=>s.value.cliente=w),icon:c(H),onClick:le},null,8,["modelValue","icon"])]),_:1},8,["label"])):D("",!0),r(F,{label:e.$t("message.project.code"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(G,{name:"codigo",modelValue:s.value.codigo,"onUpdate:modelValue":t[1]||(t[1]=w=>s.value.codigo=w),icon:c(H)},null,8,["modelValue","icon"])]),_:1},8,["label"]),r(F,{label:e.$t("message.project.date"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem",height:"3rem",background:"rgb(12, 4, 56)(38, 0, 255)"},class:"border-width: 1px;"},{default:i(()=>[r(v,{modelValue:s.value.fecha,"onUpdate:modelValue":t[2]||(t[2]=w=>s.value.fecha=w),"enable-time-picker":!1,format:O,style:{height:"3rem"}},null,8,["modelValue"])]),_:1},8,["label"]),b.value?(u(),f(F,{key:2,label:e.$t("message.project.partner"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(te,{placeholder:"Buscar...","search-function":S,"render-function":I,"debounce-time":500},null,8,["placeholder"])]),_:1},8,["label"])):D("",!0),C.value?(u(),f(F,{key:3,label:e.$t("message.project.partner"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(G,{name:"name",modelValue:s.value.persona,"onUpdate:modelValue":t[3]||(t[3]=w=>s.value.persona=w),icon:c(H),onClick:ne},null,8,["modelValue","icon"])]),_:1},8,["label"])):D("",!0)])]),_:1},8,["onSubmit"]),(m=c(h))!=null&&m.projects?D("",!0):(u(),f(x,{key:0,icon:e.mdiTableOff,title:"Empty variation"},null,8,["icon"])),(d=c(h))!=null&&d.projects?D("",!0):(u(),f(ye,{key:1,color:"danger",icon:e.mdiTableOff},{default:i(()=>[l("b",null,p(e.$t("message.empty_table"))+".",1),ke(" When there's nothing to show ")]),_:1},8,["icon"])),(W=(R=(B=c(h))==null?void 0:B.projects)==null?void 0:R.proyectos)!=null&&W.length?(u(),f(z,{key:2,class:"mb-6","has-table":""},{default:i(()=>[r(Ee,{onChangePage:A,onSort:U})]),_:1})):(u(),f(z,{key:3},{default:i(()=>[r(je)]),_:1}))]}),_:1})]),_:1})}}},Ge=ve(Ae,[["__scopeId","data-v-da47480b"]]);export{Ge as default};
