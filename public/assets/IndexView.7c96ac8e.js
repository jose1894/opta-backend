import{y as g,af as ie,ag as ce,a9 as ue,R as te,I as $,o as u,r as Y,j as l,E as p,J as R,K as Q,a as r,w as i,P as de,d as H,u as d,aN as me,ai as pe,A as X,c as f,S as ge,aJ as ae,x as ve,aI as fe,_ as be,b as Z,an as he,g as q,z as $e,B as F,O as V,C as z,e as _e,f as Pe,i as ke,ao as ye,au as G}from"./index.94f69dfc.js";import{C as Ce}from"./CardBoxComponentEmpty.c052dd4c.js";import{p as x}from"./projects.service.1804ab4d.js";import{A as ee}from"./Autocomplete.ddbf0388.js";import{c as je}from"./clients.srvice.7b743fb0.js";import{p as we}from"./personal.service.551a9226.js";const Fe=l("th",null,null,-1),Ve=["onClick"],De=["data-label"],Se=["data-label"],Le=["data-label"],Be=["data-label"],Ie=["data-label"],Me={class:"before:hidden lg:w-1 whitespace-nowrap"},Ye={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Ee={__name:"ProjectTableView",emits:["changePage","confirm","sort"],setup(oe,{emit:h}){g([]),ie(),ce();const _=ue(),P=te(),E=$(()=>P.projects.proyectos),O=$(()=>P.projects.total),k=$(()=>P.projects.perPage),b=$(()=>P.projects.page),y=g([]),C=$(()=>E.value),A=(a="")=>({0:"inactive",1:"active",2:"deleted"})[a],D=g(!1),s=a=>{D.value=!D.value,h("sort",a,D.value)},S=$(()=>Math.ceil(O.value/k.value)),j=$(()=>+b.value),N=$(()=>{const a=[];for(let n=0;n<S.value;n++)a.push(n);return a}),T=a=>{h("changePage",a)},I=a=>y.value=a,U=(a,n)=>ae(a).format(n),J=a=>{const{codigo:n,sucursal:o,_id:L}=a,{nombre:B}=o;localStorage.setItem("selectedProject",JSON.stringify(a)),_.push({name:"AuditApproach",params:{codigo:n,nombre:B,_id:L}})};return(a,n)=>(u(),Y(R,null,[l("table",null,[l("thead",null,[l("tr",null,[l("th",{onClick:n[0]||(n[0]=o=>s("codigo"))},p(a.$t("message.project.code")),1),l("th",{onClick:n[1]||(n[1]=o=>s("cliente"))},p(a.$t("message.project.client")),1),l("th",{onClick:n[2]||(n[2]=o=>s("socio"))},p(a.$t("message.project.partner")),1),l("th",null,p(a.$t("message.project.date")),1),l("th",{onClick:n[3]||(n[3]=o=>s("estado"))},p(a.$t("message.project.status")),1),Fe])]),l("tbody",null,[(u(!0),Y(R,null,Q(d(C),(o,L)=>(u(),Y("tr",{key:o._id,onClick:B=>I(o)},[l("td",{"data-label":a.$t("message.project.code")},p(o.codigo),9,De),l("td",{"data-label":a.$t("message.project.client")},p(o.cliente.nombre),9,Se),l("td",{"data-label":a.$t("message.project.partner")},p(o.socio.nombres),9,Le),l("td",{"data-label":a.$t("message.project.date")},p(U(o.fecha,"DD/MM/YYYY")),9,Be),l("td",{"data-label":a.$t("message.project.status")},p(a.$t(`message.project.statuses.${A(o.estado)}`)),9,Ie),l("td",Me,[r(X,null,{default:i(()=>[de(r(H,{color:"info",icon:d(me),small:"",onClick:B=>J(o)},null,8,["icon","onClick"]),[[pe,o.estado!==2]])]),_:2},1024)])],8,Ve))),128))])]),l("div",Ye,[r(ge,null,{default:i(()=>[r(X,null,{default:i(()=>[(u(!0),Y(R,null,Q(d(N),o=>(u(),f(H,{key:o,active:o===d(b)-1,label:o+1,color:o===d(b)?"lightDark":"whiteDark",small:"",onClick:L=>T(o+1)},null,8,["active","label","color","onClick"]))),128))]),_:1}),l("small",null,"Page "+p(d(j))+" of "+p(d(S)),1)]),_:1})])],64))}},Oe={class:"grid md:grid-cols-2 gap-4"},qe={__name:"IndexView",props:{path:"",saveLabel:"",project:{}},setup(oe){const h=te(),_=g(1),P=g(10);let E=g([]),O=g([]);const k=g(!0),b=g(!1),y=g(!0),C=g(!1),A=g([{name:"Inicio"}]),D=e=>{const t=e.getDate(),v=e.getMonth()+1,m=e.getFullYear();return`${t}/${v}/${m}`},s=g({cliente:"",idCliente:"",codigo:"",fecha:null,persona:"",idPersona:""}),S=ve({switch:[]}),j=e=>{x.index(e).then(t=>{h.projects=t,_.value=t.page,P.value=t.perPage})};j({page:_.value});const N=e=>{U({page:e})},T=(e,t)=>{J({sortBy:e,sortDesc:t})},I=e=>{x.getDelete(e).then(t=>{h.projects=t,_.value=t.page,P.value=t.perPage})},U=e=>{S.switch.length===0?j({page:e}):I({page:e})},J=(e,t)=>{S.switch.length===0?j({sortBy:e,sortDesc:t}):I({sortBy:e,sortDesc:t})},a=async e=>{var c;const t=e===""?"default":e;return((c=(await je.searchCliente(t)).data)==null?void 0:c.clientes)||[]},n=e=>{O.value.filter(m=>Object.keys(m).some(c=>c===e._id)).length===0?o(e):toast.error("El registro ya fue seleccionado")},o=(e,t)=>{s.value.cliente=e.nombreCompleto,s.value.idCliente=e.id,k.value=!k.value,b.value=!b.value},L=(e,t)=>{s.value.persona=e.nombreCompleto,s.value.idPersona=e.id,y.value=!y.value,C.value=!C.value},B=async e=>{var c;const t=e===""?"default":e;return((c=(await we.searchPersona(t)).data)==null?void 0:c.personas)||[]},se=e=>{E.value.filter(m=>Object.keys(m).some(c=>c===e._id)).length===0?L(e):toast.error("El registro ya fue seleccionado")},le=()=>{b.value=!b.value,k.value=!k.value,s.value.cliente="",s.value.idCliente=""},ne=()=>{y.value=!y.value,C.value=!C.value,s.value.persona="",s.value.idPersona=""},re=()=>{const{idCliente:e,fecha:t,codigo:v,idPersona:m}=s.value,c=t===null?"":ae(t).format("YYYY-MM-DD");if(e===""&&t===null&&v===""&&m==="")j({page:_.value});else{const M=[{codigo:v,fecha:c,cliente:e,socio:m}];j({page:_.value,q:M})}};return(e,t)=>{const v=fe("VueDatePicker");return u(),f(be,null,{default:i(()=>[r(ke,null,{default:i(()=>{var m,c,M,K,W;return[r(Z,{icon:d(ye),title:e.$t("message.project.papers")},null,8,["icon","title"]),r(he,{items:A.value},null,8,["items"]),r(q,{isForm:"",onSubmit:$e(e.submit,["prevent"]),style:{background:"rgb(134 134 145 / 16%)"}},{footer:i(()=>[r(H,{label:e.$t("message.search"),color:"success",onClick:re},null,8,["label"])]),default:i(()=>[l("div",Oe,[k.value?(u(),f(F,{key:0,label:e.$t("message.project.client"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(ee,{placeholder:"Buscar...","search-function":a,"render-function":n,"debounce-time":500},null,8,["placeholder"])]),_:1},8,["label"])):V("",!0),b.value?(u(),f(F,{key:1,label:e.$t("message.project.client"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(z,{name:"name",modelValue:s.value.cliente,"onUpdate:modelValue":t[0]||(t[0]=w=>s.value.cliente=w),icon:d(G),onClick:le},null,8,["modelValue","icon"])]),_:1},8,["label"])):V("",!0),r(F,{label:e.$t("message.project.code"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(z,{name:"codigo",modelValue:s.value.codigo,"onUpdate:modelValue":t[1]||(t[1]=w=>s.value.codigo=w),icon:d(G)},null,8,["modelValue","icon"])]),_:1},8,["label"]),r(F,{label:e.$t("message.project.date"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(v,{modelValue:s.value.fecha,"onUpdate:modelValue":t[2]||(t[2]=w=>s.value.fecha=w),"enable-time-picker":!1,format:D},null,8,["modelValue"])]),_:1},8,["label"]),y.value?(u(),f(F,{key:2,label:e.$t("message.project.partner"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(ee,{placeholder:"Buscar...","search-function":B,"render-function":se,"debounce-time":500},null,8,["placeholder"])]),_:1},8,["label"])):V("",!0),C.value?(u(),f(F,{key:3,label:e.$t("message.project.partner"),style:{"padding-top":"0.5rem","padding-bottom":"0.5rem"}},{default:i(()=>[r(z,{name:"name",modelValue:s.value.persona,"onUpdate:modelValue":t[3]||(t[3]=w=>s.value.persona=w),icon:d(G),onClick:ne},null,8,["modelValue","icon"])]),_:1},8,["label"])):V("",!0)])]),_:1},8,["onSubmit"]),(m=d(h))!=null&&m.projects?V("",!0):(u(),f(Z,{key:0,icon:e.mdiTableOff,title:"Empty variation"},null,8,["icon"])),(c=d(h))!=null&&c.projects?V("",!0):(u(),f(_e,{key:1,color:"danger",icon:e.mdiTableOff},{default:i(()=>[l("b",null,p(e.$t("message.empty_table"))+".",1),Pe(" When there's nothing to show ")]),_:1},8,["icon"])),(W=(K=(M=d(h))==null?void 0:M.projects)==null?void 0:K.proyectos)!=null&&W.length?(u(),f(q,{key:2,class:"mb-6","has-table":""},{default:i(()=>[r(Ee,{onChangePage:N,onSort:T})]),_:1})):(u(),f(q,{key:3},{default:i(()=>[r(Ce)]),_:1}))]}),_:1})]),_:1})}}};export{qe as default};
