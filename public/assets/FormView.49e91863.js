import{q as x,y as h,ag as H,ah as J,at as Q,aa as W,aK as Y,I as X,au as Z,o as ee,c as ae,w as u,j as _,a as t,d as R,B as p,u as d,C as v,av as se,aL as oe,aw as y,ax as S,z as te,g as le}from"./index.e27aaed2.js";import{r as B,u as ie}from"./index.esm.6263d8b1.js";import{b as re}from"./bussinesUnit.service.20bca8ab.js";import{c as ne}from"./categories.service.315771c8.js";import{r as C}from"./rates.service.08e6cbba.js";const de={class:"container mx-auto"},ue={class:"grid md:grid-cols-3 gap-3"},ce={class:"grid md:grid-cols-2 gap-2"},me={style:{display:"flex","justify-content":"space-between"}},ge={__name:"FormView",props:{path:"",saveLabel:"",state:{}},setup(j){const b=j,I=h({date:"DD-MM-YYYY",month:"MMM"}),{t:V}=H(),U=J(),T=Q(),L=W();let D=h([]),M=h([]),k=h([!1]);const N=[{id:1,label:V("message.rate.statuses.active")},{id:0,label:V("message.rate.statuses.inactive")}],a=h({_id:"",codigo:"00",fecha:Y(new Date,"DD-MM-YYYY").format("DD-MM-YYYY"),siglas:"",categoria:M.value,unidadNegocio:D.value,actual:0,anterior:0,estado:N[0]}),q=X(()=>({codigo:{required:B},fecha:{required:B},siglas:{required:B}})),w=ie(q,a);Z(async()=>{var r,i;let s=await re.allBussinesUnitGet();const e=(s==null?void 0:s.data.unidadesNegocio)||[];if(D.value=e.map(o=>({id:o._id,label:o.nombre})),b.path==="update"){const o=await C.read(T.params),n="DD-MM-YYYY",c=Y(o.data.fecha).format(n);a.value=o.data,a.value.fecha=c,a.value.unidadNegocio=F((r=o.data)==null?void 0:r.unidadNegocio),a.value.estado=N.filter(f=>f.id===o.data.estado)[0],O(a.value.unidadNegocio,(i=o.data)==null?void 0:i.categoria);const m=Y(a.value.fecha,n),g=Y(new Date,n);k.value=g.isAfter(m),console.log(k)}});const F=s=>({id:s._id,label:s.nombre}),O=(s,e={})=>{const{id:r}=s;M.value=[],A(r).then(i=>{const o=i.data.categorias||[];M.value=o.map(n=>({id:n._id,label:n.nombre})),b.path==="update"&&(a.value.categoria=F(e))}).catch(i=>{console.log(i)})},A=async s=>await ne.categoriasPorUnidadNegocio(s),z=s=>{const{_id:e,codigo:r,fecha:i,siglas:o,unidadNegocio:n,categoria:c,actual:m,anterior:g,estado:f}=s.value,$={_id:e,codigo:r,fecha:i.undefined,siglas:o.toUpperCase(),unidadNegocio:n.id,categoria:c.id,actual:m,anterior:g,estado:f.id};return b.path==="create"?($.fecha=Y(new Date,"DD-MM-YYYY").format("DD-MM-YYYY"),C.create($)):C.update($)},E=b.path==="create"?V("message.rate.created.success"):V("message.rate.updated.success"),G=b.path==="create"?V("message.rate.created.error"):V("message.rate.updated.error"),K=async()=>{await w.value.$validate()?z(a).then(()=>{U.success(E),L.push("/setup/rates")}).catch(e=>{var r,i,o;if((i=(r=e.response)==null?void 0:r.data)!=null&&i.msg){U.error(`${G} ${e.response.data.msg}`);return}if((o=e.response.data)!=null&&o.errors){const n=e.response.data.errors;let c="";for(let m of Object.values(n))m.forEach(function(g,f){c+=g});U.error(`${c}`)}}):console.log("error")},P=()=>L.push("/setup/rates");return(s,e)=>(ee(),ae(le,{isForm:"",onSubmit:te(K,["prevent"])},{footer:u(()=>[_("div",me,[t(R,{label:s.$t(`message.${b.saveLabel}`),type:"submit",color:"success"},null,8,["label"]),t(R,{label:s.$t("message.return"),color:"info",onClick:e[8]||(e[8]=r=>P())},null,8,["label"])])]),default:u(()=>{var r,i,o,n,c,m,g,f,$;return[_("div",null,[_("div",de,[_("div",ue,[t(p,{label:s.$t("message.rate.code"),help:(o=(i=(r=d(w))==null?void 0:r.codigo)==null?void 0:i.$errors[0])==null?void 0:o.$message},{default:u(()=>[t(v,{name:"codigo",modelValue:a.value.codigo,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.codigo=l),icon:d(se)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),t(p,{label:s.$t("message.rate.date")},{default:u(()=>[t(d(oe),{class:"h-12 border-gray-700",formatter:I.value,"as-single":"",modelValue:a.value.fecha,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.fecha=l),disabled:!0},null,8,["formatter","modelValue"])]),_:1},8,["label"]),t(p,{label:s.$t("message.rate.acronyms"),help:(m=(c=(n=d(w))==null?void 0:n.siglas)==null?void 0:c.$errors[0])==null?void 0:m.$message},{default:u(()=>[t(v,{modelValue:a.value.siglas,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.siglas=l),icon:d(y)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),t(p,{label:s.$t("message.rate.businessUnit")},{default:u(()=>[t(v,{modelValue:a.value.unidadNegocio,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.unidadNegocio=l),icon:d(S),options:d(D),onOnSelectChange:O},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),t(p,{label:s.$t("message.rate.categories")},{default:u(()=>[t(v,{modelValue:a.value.categoria,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.categoria=l),icon:d(S),options:d(M)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),t(p,{label:s.$t("message.rate.currentRate")},{default:u(()=>[t(v,{modelValue:a.value.actual,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.actual=l),icon:d(y)},null,8,["modelValue","icon"])]),_:1},8,["label"])]),_("div",ce,[t(p,{label:s.$t("message.rate.previousRate")},{default:u(()=>[t(v,{modelValue:a.value.anterior,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.anterior=l),icon:d(y)},null,8,["modelValue","icon"])]),_:1},8,["label"]),t(p,{label:s.$t("message.rate.status"),help:($=(f=(g=d(w))==null?void 0:g.estado)==null?void 0:f.$errors[0])==null?void 0:$.$message},{default:u(()=>[t(v,{modelValue:a.value.estado,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.estado=l),icon:d(S),options:N},null,8,["modelValue","icon"])]),_:1},8,["label","help"])])])])]}),_:1},8,["onSubmit"]))}},$e=x(ge,[["__scopeId","data-v-937bf8ff"]]);export{$e as F};
