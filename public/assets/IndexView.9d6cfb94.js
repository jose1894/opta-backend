import{ag as ie,ah as ue,y as g,x as ce,au as me,o as pe,r as ve,a as o,w as n,$ as O,_ as be,K as fe,j as h,f as T,E as F,g as ge,z as he,d as N,B as v,C as b,u,i as Ve,b as Ne,aM as $e,av as Y,ax as I,aq as E,aK as Pe}from"./index.e27aaed2.js";import{e as $}from"./enfoques.service.4fd8f7ec.js";const ye={class:"grid md:grid-cols-2 gap-2"},_e={class:"grid md:grid-cols-1 gap-1"},we={class:"container mx-auto"},Me={class:"grid md:grid-cols-4 gap-4 flex items-center"},qe={__name:"IndexView",props:{path:"",saveLabel:"",state:{}},setup(z){const P=z,{t:r}=ie(),y=ue(),q=g(!1),f=g(!1),K=!1,c=g({}),U=g(!1);let j="";const m=[{id:0,label:r("message.no")},{id:1,label:r("message.yes")}],_=[{id:0,label:r("message.list")},{id:1,label:r("message.menu")}],w=[{id:1,label:r("message.approach.statuses.active")},{id:0,label:r("message.approach.statuses.inactive")}],k={_id:"",indice:0,nombre:"",areaPadreNombre:"",rutaPadre:"",areaPadre:"",ruta:"",visible:_[0],rcr:m[0],editable:m[0],estado:w[0],tipoNodo:2},l=g(k),L=ce({selectedNodeId:null}),D=g(),A=(e,a=[])=>{e.map(s=>{const d=a.filter(t=>{var p;return((p=t==null?void 0:t.areaPadre)==null?void 0:p._id)===s._id});return d.length>0&&(s.children=d,A(d,a)),s})};me(async()=>{S(),P.path==="update"&&console.log(P.path)});const S=async()=>{let e=await $.index();const{enfoques:a}=e,s=a.filter(t=>t.tipoNodo===0),d=a.filter(t=>t.tipoNodo!==0);A(s,d),s[0].collapsed=!0,D.value=s},G=P.path==="create"?r("message.approach.created.success"):r("message.approach.updated.success");P.path==="create"?r("message.approach.created.error"):r("message.approach.updated.error");const H=async()=>{J(l).then(()=>{const e=c.value;B(e),setTimeout(()=>{f.value=!1,l.value=k,y.success(G)},500)}).catch(e=>{var a,s,d,t;if(console.log(e),(s=(a=e.response)==null?void 0:a.data)!=null&&s.msg){y.error(`${r("message.approach.created.error")} ${e.response.data.msg}`);return}if((t=(d=e.response)==null?void 0:d.data)!=null&&t.errors){const p=e.response.data.errors;for(let V of p);}})},J=async e=>{e.value.tipoNodo=e.value.rutaPadre==="/"?1:2;const{_id:a,indice:s,nombre:d,areaPadre:t,areaPadreNombre:p,rutaPadre:V,ruta:i,visible:se,rcr:oe,editable:te,estado:re,tipoNodo:de}=e.value,C={_id:a,indice:s,nombre:d,areaPadre:t,areaPadreNombre:p,rutaPadre:V,ruta:i,visible:se.id,rcr:oe.id,editable:te.id,estado:re.id,tipoNodo:de};if(j==="create"){const ne=Pe(C.fecha,"YYYY-MM-DD").format("YYYY-MM-DD");return C.fecha=ne,$.create(C)}return $.update(C)};r("message.approach.selectedNode");const Q=()=>{if(l.value=k,j="create",q.value=!1,Object.keys(c.value).length===0){q.value=!0;const e=Object.assign({},D.value[0]);l.value=e,l.value.areaPadreNombre=e.nombre,l.value.nombre="",l.value.rutaPadre="/",l.value.areaPadre=e._id,l.value.estado=w.filter(a=>a.id===e.estado)[0],l.value.visible=_.filter(a=>a.id===e.visible)[0],l.value.rcr=m.filter(a=>a.id===e.rcr)[0],l.value.editable=m.filter(a=>a.id===e.editable)[0],l.value.tipoNodo=1,c.value=l.value}f.value=!0},R=async()=>{j="update",l.value=c.value;const{visible:e,estado:a,rcr:s,editable:d,areaPadre:t,areaPadreNombre:p,rutaPadre:V}=c.value;if(console.log(c.value),t){l.value.areaPadre=typeof t=="object"?t._id:t,l.value.areaPadreNombre=typeof t=="object"?t.nombre:p;const i=typeof t=="object"?t.ruta:V;l.value.rutaPadre=i!==void 0?i:V}l.value.estado=w.filter(i=>i.id===M(a))[0],l.value.visible=_.filter(i=>i.id===M(e))[0],l.value.rcr=m.filter(i=>i.id===M(s))[0],l.value.editable=m.filter(i=>i.id===M(d))[0],f.value=!0},M=e=>typeof e=="object"?e.id:e,B=async e=>{var a;if(q.value)S();else{e.children=[];const s=await $.getChildren(e._id),d=((a=s==null?void 0:s.data)==null?void 0:a.children)||[];e.children=d}},W=e=>{c.value=e,l.value.areaPadre=e._id,l.value.areaPadreNombre=e.nombre,l.value.rutaPadre=e.ruta},X=e=>{B(e),W(e)},Z=()=>{const{nombre:e}=c.value;return e},x=r("message.approach.deleted.success"),ee=async()=>{ae().then(async()=>{S(),y.success(x)}).catch(e=>{var a;y.error(`${r("message.approach.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},ae=()=>{const{_id:e}=c.value;return $.delete(e)},le=()=>f.value=!1;return(e,a)=>(pe(),ve(fe,null,[o(O,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=s=>U.value=s),title:"Please confirm",button:"danger",onConfirm:ee,"has-cancel":""},{default:n(()=>[h("strong",null,[T(F(e.$t("message.approach.deleted.question"))+" ",1),h("b",null,F(Z()),1)]),T(" ? ")]),_:1},8,["modelValue"]),o(O,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=s=>f.value=s),title:"Crear enfoque",hasDone:K,claseModal:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-8/12 xl:w-8/12 z-50"},{default:n(()=>[o(ge,{isForm:"",onSubmit:he(H,["prevent"]),style:{height:"500px","overflow-y":"scroll","scroll-behavior":"smooth"}},{footer:n(()=>[o(N,{label:e.$t("message.submit"),type:"submit",color:"success"},null,8,["label"]),o(N,{label:e.$t("message.cancel"),color:"info",style:{"margin-left":"5px"},onClick:le},null,8,["label"])]),default:n(()=>[h("div",ye,[o(v,{label:e.$t("message.approach.indice")},{default:n(()=>[o(b,{name:"indice",modelValue:l.value.indice,"onUpdate:modelValue":a[1]||(a[1]=s=>l.value.indice=s),icon:u(Y)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(v,{label:e.$t("message.approach.name")},{default:n(()=>[o(b,{name:"name",modelValue:l.value.nombre,"onUpdate:modelValue":a[2]||(a[2]=s=>l.value.nombre=s),icon:u(Y)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(v,{label:e.$t("message.approach.parentArea")},{default:n(()=>[o(b,{name:"parentArea",modelValue:l.value.areaPadreNombre,"onUpdate:modelValue":a[3]||(a[3]=s=>l.value.areaPadreNombre=s),icon:u(Y),readonly:!0},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(v,{label:e.$t("message.approach.visible")},{default:n(()=>[o(b,{modelValue:l.value.visible,"onUpdate:modelValue":a[4]||(a[4]=s=>l.value.visible=s),icon:u(I),options:_},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(v,{label:e.$t("message.approach.rcr")},{default:n(()=>[o(b,{modelValue:l.value.rcr,"onUpdate:modelValue":a[5]||(a[5]=s=>l.value.rcr=s),icon:u(I),options:m},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(v,{label:e.$t("message.approach.editable")},{default:n(()=>[o(b,{modelValue:l.value.editable,"onUpdate:modelValue":a[6]||(a[6]=s=>l.value.editable=s),icon:u(I),options:m},null,8,["modelValue","icon"])]),_:1},8,["label"])]),h("div",_e,[o(v,{label:e.$t("message.approach.status")},{default:n(()=>[o(b,{modelValue:l.value.estado,"onUpdate:modelValue":a[7]||(a[7]=s=>l.value.estado=s),icon:u(I),options:w},null,8,["modelValue","icon"])]),_:1},8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"]),o(be,null,{default:n(()=>[o(Ve,null,{default:n(()=>[o(Ne,{icon:e.mdiGlobeModel,title:e.$t("message.approach.approaches")},null,8,["icon","title"]),h("div",we,[h("div",Me,[o(N,{icon:u(E),label:e.$t("message.add_new"),color:"success",small:"",onClick:Q},null,8,["icon","label"]),o(N,{icon:u(E),label:e.$t("message.edit"),color:"success",small:"",onClick:R},null,8,["icon","label"]),o(N,{icon:u(E),label:e.$t("message.delete"),color:"success",small:"",onClick:a[9]||(a[9]=s=>U.value=!0)},null,8,["icon","label"])])]),o($e,{nodes:D.value,selectedNodeId:L.selectedNodeId,onNodeSelected:X},null,8,["nodes","selectedNodeId"])]),_:1})]),_:1})],64))}};export{qe as default};
