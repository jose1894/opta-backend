import{q as K,af as Q,ag as W,as as X,a9 as Y,y as w,I as Z,at as ee,o as ae,c as se,w as r,a as o,d as te,j as f,B as p,u as i,C as b,au as oe,av as E,aw as S,z as le,g as ie}from"./index.94f69dfc.js";import{r as U,m as ne,u as de}from"./index.esm.8eaf8d5b.js";import{c as ue}from"./cities.service.6e8d35a5.js";import{s as re}from"./states.services.447377dd.js";import{c as ce}from"./countries.service.e775474b.js";import{b as F}from"./branches.service.d19c5d13.js";const me={class:"container mx-auto"},pe={class:"grid md:grid-cols-3 gap-3"},be={class:"grid md:grid-cols-2 gap-2"},ge={class:"grid md:grid-cols-2 gap-2"},ve={__name:"FormView",props:{path:"",saveLabel:"",state:{}},setup(N){const c=N,{t:m}=Q(),M=W(),P=X(),j=Y(),B=[{id:1,label:m("message.branch.statuses.active")},{id:0,label:m("message.branch.statuses.inactive")},{id:2,label:m("message.branch.statuses.deleted")}];let C=w([]),_=w([]),V=w([]);const t=w({_id:"",codigo:"00",nombre:"",siglas:"",pais:C.value,state:_.value,ciudad:V.value,estado:B[0]}),z=Z(()=>({codigo:{required:U,maxLength:ne(3)},nombre:{required:U},siglas:{required:U}})),g=de(z,t);ee(async()=>{var l;let s=await ce.index();const e=(s==null?void 0:s.paises)||[];if(C.value=e.map(a=>({id:a._id,label:a.nombre})),c.path==="update"){const a=await F.read(P.params);t.value=a.data,t.value.pais=L((l=a.data)==null?void 0:l.pais),O(t.value.pais,a.data),t.value.estado=B.filter(n=>n.id===a.data.estado)[0]}});const L=s=>({id:s._id,label:s.nombre}),O=(s,e={})=>{const{id:l}=s;V.value=[],_.value=[],A(l).then(a=>{const n=(a==null?void 0:a.estados)||[];_.value=n.map(u=>({id:u._id,label:u.nombre})),c.path==="update"&&(t.value.state=L(e==null?void 0:e.state),I(t.value.state,e==null?void 0:e.ciudad))}).catch(a=>{console.log(a)})},A=async s=>await re.estadosByPais(s),I=(s,e={})=>{const{id:l}=s;T(l).then(a=>{const n=(a==null?void 0:a.ciudades)||[];V.value=n.map(u=>({id:u._id,label:u.nombre})),c.path==="update"&&(t.value.ciudad=L(e))}).catch(a=>{console.log(a)})},T=async s=>await ue.ciudadesByEstados(s),D=s=>{const{_id:e,codigo:l,nombre:a,siglas:n,pais:u,state:v,ciudad:$,estado:y}=s.value,h={_id:e,codigo:l,nombre:a,siglas:n,pais:u.id,state:v.id,ciudad:$.id,estado:y.id};return c.path==="create"?F.create(h):F.update(h)},G=c.path==="create"?m("message.branch.created.success"):m("message.branch.updated.success"),H=c.path==="create"?m("message.branch.created.error"):m("message.branch.updated.error"),J=async()=>{await g.value.$validate()?D(t).then(()=>{M.success(G),j.push("/setup/branches")}).catch(e=>{var l,a,n;if((a=(l=e.response)==null?void 0:l.data)!=null&&a.msg){M.error(`${H} ${e.response.data.msg}`);return}if((n=e.response.data)!=null&&n.errors){const u=e.response.data.errors;for(let v of u);}}):console.log("error")};return(s,e)=>(ae(),se(ie,{isForm:"",onSubmit:le(J,["prevent"])},{footer:r(()=>[o(te,{label:s.$t(`message.${c.saveLabel}`),type:"submit",color:"success"},null,8,["label"])]),default:r(()=>{var l,a,n,u,v,$,y,h,R,k,q,x;return[f("div",null,[f("div",me,[f("div",pe,[o(p,{label:s.$t("message.branch.code"),help:(n=(a=(l=i(g))==null?void 0:l.codigo)==null?void 0:a.$errors[0])==null?void 0:n.$message},{default:r(()=>[o(b,{name:"codigo",modelValue:t.value.codigo,"onUpdate:modelValue":e[0]||(e[0]=d=>t.value.codigo=d),icon:i(oe)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),o(p,{label:s.$t("message.branch.name"),help:($=(v=(u=i(g))==null?void 0:u.nombre)==null?void 0:v.$errors[0])==null?void 0:$.$message},{default:r(()=>[o(b,{modelValue:t.value.nombre,"onUpdate:modelValue":e[1]||(e[1]=d=>t.value.nombre=d),icon:i(E)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),o(p,{label:s.$t("message.branch.acronyms"),help:(R=(h=(y=i(g))==null?void 0:y.siglas)==null?void 0:h.$errors[0])==null?void 0:R.$message},{default:r(()=>[o(b,{modelValue:t.value.siglas,"onUpdate:modelValue":e[2]||(e[2]=d=>t.value.siglas=d),icon:i(E)},null,8,["modelValue","icon"])]),_:1},8,["label","help"])]),f("div",be,[o(p,{label:s.$t("message.branch.country")},{default:r(()=>[o(b,{modelValue:t.value.pais,"onUpdate:modelValue":e[3]||(e[3]=d=>t.value.pais=d),icon:i(S),options:i(C),onOnSelectChange:O},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(p,{label:s.$t("message.branch.state")},{default:r(()=>[o(b,{modelValue:t.value.state,"onUpdate:modelValue":e[4]||(e[4]=d=>t.value.state=d),icon:i(S),options:i(_),onOnSelectChange:I},null,8,["modelValue","icon","options"])]),_:1},8,["label"])]),f("div",ge,[o(p,{label:s.$t("message.branch.city")},{default:r(()=>[o(b,{modelValue:t.value.ciudad,"onUpdate:modelValue":e[5]||(e[5]=d=>t.value.ciudad=d),icon:i(S),options:i(V)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(p,{label:s.$t("message.branch.status"),help:(x=(q=(k=i(g))==null?void 0:k.estado)==null?void 0:q.$errors[0])==null?void 0:x.$message},{default:r(()=>[o(b,{modelValue:t.value.estado,"onUpdate:modelValue":e[6]||(e[6]=d=>t.value.estado=d),icon:i(S),options:B},null,8,["modelValue","icon"])]),_:1},8,["label","help"])])])])]}),_:1},8,["onSubmit"]))}},we=K(ve,[["__scopeId","data-v-15237ab3"]]);export{we as F};
