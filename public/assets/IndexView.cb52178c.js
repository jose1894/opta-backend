import{u as ie,ak as ue,r as g,U as ce,ax as me,o as pe,h as ve,i as o,a as n,A as be,F as fe,b as h,z as T,t as F,j as ge,_ as v,p as u,B as he,ay as Y,ar as I,aq as A,aL as Ve}from"./index.fced531f.js";import{_ as Ne,a as N}from"./BaseButton.e5b26bef.js";import{e as $,T as $e}from"./enfoques.service.41a77196.js";import{_ as b}from"./FormField.7d4d56fa.js";import{C as O}from"./CardBoxModal.14424565.js";import{_ as Pe}from"./SectionTitleLineWithButton.fa502c3a.js";const ye={class:"grid md:grid-cols-2 gap-2"},_e={class:"grid md:grid-cols-1 gap-1"},Me={class:"container mx-auto"},we={class:"grid md:grid-cols-4 gap-4 flex items-center"},De={__name:"IndexView",props:{path:"",saveLabel:"",state:{}},setup(L){const P=L,{t:r}=ie(),y=ue(),q=g(!1),f=g(!1),z=!1,c=g({}),U=g(!1);let k="";const m=[{id:0,label:r("message.no")},{id:1,label:r("message.yes")}],_=[{id:0,label:r("message.list")},{id:1,label:r("message.menu")}],M=[{id:1,label:r("message.approach.statuses.active")},{id:0,label:r("message.approach.statuses.inactive")}],j={_id:"",indice:0,nombre:"",areaPadreNombre:"",rutaPadre:"",areaPadre:"",ruta:"",visible:_[0],rcr:m[0],editable:m[0],estado:M[0],tipoNodo:2},l=g(j),G=ce({selectedNodeId:null}),D=g(),B=(e,a=[])=>{e.map(s=>{const d=a.filter(t=>{var p;return((p=t==null?void 0:t.areaPadre)==null?void 0:p._id)===s._id});return d.length>0&&(s.children=d,B(d,a)),s})};me(async()=>{S(),P.path==="update"&&console.log(P.path)});const S=async()=>{let e=await $.index();const{enfoques:a}=e,s=a.filter(t=>t.tipoNodo===0),d=a.filter(t=>t.tipoNodo!==0);B(s,d),s[0].collapsed=!0,D.value=s},H=P.path==="create"?r("message.approach.created.success"):r("message.approach.updated.success");P.path==="create"?r("message.approach.created.error"):r("message.approach.updated.error");const J=async()=>{K(l).then(()=>{const e=c.value;E(e),setTimeout(()=>{f.value=!1,l.value=j,y.success(H)},500)}).catch(e=>{var a,s,d,t;if(console.log(e),(s=(a=e.response)==null?void 0:a.data)!=null&&s.msg){y.error(`${r("message.approach.created.error")} ${e.response.data.msg}`);return}if((t=(d=e.response)==null?void 0:d.data)!=null&&t.errors){const p=e.response.data.errors;for(let V of p);}})},K=async e=>{e.value.tipoNodo=e.value.rutaPadre==="/"?1:2;const{_id:a,indice:s,nombre:d,areaPadre:t,areaPadreNombre:p,rutaPadre:V,ruta:i,visible:se,rcr:oe,editable:te,estado:re,tipoNodo:de}=e.value,C={_id:a,indice:s,nombre:d,areaPadre:t,areaPadreNombre:p,rutaPadre:V,ruta:i,visible:se.id,rcr:oe.id,editable:te.id,estado:re.id,tipoNodo:de};if(k==="create"){const ne=Ve(C.fecha,"YYYY-MM-DD").format("YYYY-MM-DD");return C.fecha=ne,$.create(C)}return $.update(C)};r("message.approach.selectedNode");const Q=()=>{if(l.value=j,k="create",q.value=!1,Object.keys(c.value).length===0){q.value=!0;const e=Object.assign({},D.value[0]);l.value=e,l.value.areaPadreNombre=e.nombre,l.value.nombre="",l.value.rutaPadre="/",l.value.areaPadre=e._id,l.value.estado=M.filter(a=>a.id===e.estado)[0],l.value.visible=_.filter(a=>a.id===e.visible)[0],l.value.rcr=m.filter(a=>a.id===e.rcr)[0],l.value.editable=m.filter(a=>a.id===e.editable)[0],l.value.tipoNodo=1,c.value=l.value}f.value=!0},R=async()=>{k="update",l.value=c.value;const{visible:e,estado:a,rcr:s,editable:d,areaPadre:t,areaPadreNombre:p,rutaPadre:V}=c.value;if(console.log(c.value),t){l.value.areaPadre=typeof t=="object"?t._id:t,l.value.areaPadreNombre=typeof t=="object"?t.nombre:p;const i=typeof t=="object"?t.ruta:V;l.value.rutaPadre=i!==void 0?i:V}l.value.estado=M.filter(i=>i.id===w(a))[0],l.value.visible=_.filter(i=>i.id===w(e))[0],l.value.rcr=m.filter(i=>i.id===w(s))[0],l.value.editable=m.filter(i=>i.id===w(d))[0],f.value=!0},w=e=>typeof e=="object"?e.id:e,E=async e=>{var a;if(q.value)S();else{e.children=[];const s=await $.getChildren(e._id),d=((a=s==null?void 0:s.data)==null?void 0:a.children)||[];e.children=d}},W=e=>{c.value=e,l.value.areaPadre=e._id,l.value.areaPadreNombre=e.nombre,l.value.rutaPadre=e.ruta},X=e=>{E(e),W(e)},Z=()=>{const{nombre:e}=c.value;return e},x=r("message.approach.deleted.success"),ee=async()=>{ae().then(async()=>{S(),y.success(x)}).catch(e=>{var a;y.error(`${r("message.approach.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},ae=()=>{const{_id:e}=c.value;return $.delete(e)},le=()=>f.value=!1;return(e,a)=>(pe(),ve(fe,null,[o(O,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=s=>U.value=s),title:e.$t("message.pleaseConfirm"),button:"danger",onConfirm:ee,"has-cancel":""},{default:n(()=>[h("strong",null,[T(F(e.$t("message.approach.deleted.question"))+" ",1),h("b",null,F(Z()),1)]),T(" ? ")]),_:1},8,["modelValue","title"]),o(O,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=s=>f.value=s),title:"Crear enfoque",hasDone:z,claseModal:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-8/12 xl:w-8/12 z-50"},{default:n(()=>[o(Ne,{isForm:"",onSubmit:ge(J,["prevent"]),style:{height:"500px","overflow-y":"scroll","scroll-behavior":"smooth"}},{footer:n(()=>[o(N,{label:e.$t("message.submit"),type:"submit",color:"success"},null,8,["label"]),o(N,{label:e.$t("message.cancel"),color:"info",style:{"margin-left":"5px"},onClick:le},null,8,["label"])]),default:n(()=>[h("div",ye,[o(b,{label:e.$t("message.approach.indice")},{default:n(()=>[o(v,{name:"indice",modelValue:l.value.indice,"onUpdate:modelValue":a[1]||(a[1]=s=>l.value.indice=s),icon:u(Y)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(b,{label:e.$t("message.approach.name")},{default:n(()=>[o(v,{name:"name",modelValue:l.value.nombre,"onUpdate:modelValue":a[2]||(a[2]=s=>l.value.nombre=s),icon:u(Y)},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(b,{label:e.$t("message.approach.parentArea")},{default:n(()=>[o(v,{name:"parentArea",modelValue:l.value.areaPadreNombre,"onUpdate:modelValue":a[3]||(a[3]=s=>l.value.areaPadreNombre=s),icon:u(Y),readonly:!0},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(b,{label:e.$t("message.approach.visible")},{default:n(()=>[o(v,{modelValue:l.value.visible,"onUpdate:modelValue":a[4]||(a[4]=s=>l.value.visible=s),icon:u(I),options:_},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(b,{label:e.$t("message.approach.rcr")},{default:n(()=>[o(v,{modelValue:l.value.rcr,"onUpdate:modelValue":a[5]||(a[5]=s=>l.value.rcr=s),icon:u(I),options:m},null,8,["modelValue","icon"])]),_:1},8,["label"]),o(b,{label:e.$t("message.approach.editable")},{default:n(()=>[o(v,{modelValue:l.value.editable,"onUpdate:modelValue":a[6]||(a[6]=s=>l.value.editable=s),icon:u(I),options:m},null,8,["modelValue","icon"])]),_:1},8,["label"])]),h("div",_e,[o(b,{label:e.$t("message.approach.status")},{default:n(()=>[o(v,{modelValue:l.value.estado,"onUpdate:modelValue":a[7]||(a[7]=s=>l.value.estado=s),icon:u(I),options:M},null,8,["modelValue","icon"])]),_:1},8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"]),o(be,null,{default:n(()=>[o(he,null,{default:n(()=>[o(Pe,{icon:e.mdiGlobeModel,title:e.$t("message.approach.approaches")},null,8,["icon","title"]),h("div",Me,[h("div",we,[o(N,{icon:u(A),label:e.$t("message.add_new"),color:"success",small:"",onClick:Q},null,8,["icon","label"]),o(N,{icon:u(A),label:e.$t("message.edit"),color:"success",small:"",onClick:R},null,8,["icon","label"]),o(N,{icon:u(A),label:e.$t("message.delete"),color:"success",small:"",onClick:a[9]||(a[9]=s=>U.value=!0)},null,8,["icon","label"])])]),o($e,{nodes:D.value,selectedNodeId:G.selectedNodeId,onNodeSelected:X},null,8,["nodes","selectedNodeId"])]),_:1})]),_:1})],64))}};export{De as default};
