import{u as J,ak as K,au as Q,ae as W,r as w,g as X,ax as Y,o as Z,c as ee,a as u,b as g,i as o,N as ae,d as se,_ as m,p as d,ay as te,S as oe,az as j,ar as S,j as le}from"./index.94d0d825.js";import{r as z,u as ie}from"./index.esm.5aa1a710.js";import{b as ne,a as E,_ as de}from"./BaseButton.607b4ca4.js";import{_ as p}from"./FormField.d7b1190e.js";import{c as re}from"./cities.service.d5f5c452.js";import{s as ue}from"./states.services.4056bce2.js";import{c as ce}from"./countries.service.a9d4a57b.js";import{b as F}from"./branches.service.03e48df9.js";const me={class:"container mx-auto"},pe={class:"grid md:grid-cols-2 gap-2"},be={class:"grid md:grid-cols-2 gap-2"},ge={style:{display:"flex","justify-content":"space-between"}},ve={__name:"FormView",props:{path:"",saveLabel:"",state:{}},setup(B){const c=B,{t:b}=J(),k=K(),I=Q(),M=W(),C=[{id:1,label:b("message.branch.statuses.active")},{id:0,label:b("message.branch.statuses.inactive")}];let U=w([]),h=w([]),V=w([]);const t=w({_id:"",codigo:"00",nombre:"",siglas:"",pais:U.value,state:h.value,ciudad:V.value,estado:C[0]}),P=X(()=>({nombre:{required:z},siglas:{required:z}})),$=ie(P,t);Y(async()=>{var l;let a=await ce.index();const e=(a==null?void 0:a.paises)||[];if(U.value=e.map(s=>({id:s._id,label:s.nombre})),c.path==="update"){const s=await F.read(I.params);t.value=s.data,t.value.pais=L((l=s.data)==null?void 0:l.pais),O(t.value.pais,s.data),t.value.estado=C.filter(i=>i.id===s.data.estado)[0]}});const L=a=>({id:a._id,label:a.nombre}),O=(a,e={})=>{const{id:l}=a;V.value=[],h.value=[],T(l).then(s=>{const i=(s==null?void 0:s.estados)||[];h.value=i.map(r=>({id:r._id,label:r.nombre})),c.path==="update"&&(t.value.state=L(e==null?void 0:e.state),N(t.value.state,e==null?void 0:e.ciudad))}).catch(s=>{console.log(s)})},T=async a=>await ue.estadosByPais(a),N=(a,e={})=>{const{id:l}=a;q(l).then(s=>{const i=(s==null?void 0:s.ciudades)||[];V.value=i.map(r=>({id:r._id,label:r.nombre})),c.path==="update"&&(t.value.ciudad=L(e))}).catch(s=>{console.log(s)})},q=async a=>await re.ciudadesByEstados(a),x=a=>{const{_id:e,codigo:l,nombre:s,siglas:i,pais:r,state:v,ciudad:_,estado:y}=a.value,f={_id:e,codigo:l,nombre:s,siglas:i,pais:r.id,state:v.id,ciudad:_.id,estado:y.id};return c.path==="create"?F.create(f):F.update(f)},A=c.path==="create"?b("message.branch.created.success"):b("message.branch.updated.success"),D=c.path==="create"?b("message.branch.created.error"):b("message.branch.updated.error"),G=async()=>{await $.value.$validate()?x(t).then(()=>{k.success(A),M.push("/setup/branches")}).catch(e=>{var l,s,i;if((s=(l=e.response)==null?void 0:l.data)!=null&&s.msg){k.error(`${D} ${e.response.data.msg}`);return}if((i=e.response.data)!=null&&i.errors){const r=e.response.data.errors;for(let v of r);}}):console.log("error")},H=()=>M.push("/setup/branches");return(a,e)=>(Z(),ee(de,{isForm:"",onSubmit:le(G,["prevent"])},{footer:u(()=>[g("div",ge,[o(E,{label:a.$t(`message.${c.saveLabel}`),type:"submit",color:"success"},null,8,["label"]),o(E,{label:a.$t("message.return"),color:"info",onClick:e[7]||(e[7]=l=>H())},null,8,["label"])])]),default:u(()=>{var l,s,i,r,v,_,y,f,R;return[g("div",null,[g("div",me,[g("div",{class:ae(B.path!=="create"?"grid md:grid-cols-3 gap-3":"grid md:grid-cols-2 gap-3")},[se(o(p,{label:a.$t("message.branch.code")},{default:u(()=>[o(m,{name:"codigo",modelValue:t.value.codigo,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.codigo=n),icon:d(te)},null,8,["modelValue","icon"])]),_:1},8,["label"]),[[oe,B.path!=="create"]]),o(p,{label:a.$t("message.branch.name"),help:(i=(s=(l=d($))==null?void 0:l.nombre)==null?void 0:s.$errors[0])==null?void 0:i.$message},{default:u(()=>[o(m,{modelValue:t.value.nombre,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.nombre=n),icon:d(j)},null,8,["modelValue","icon"])]),_:1},8,["label","help"]),o(p,{label:a.$t("message.branch.acronyms"),help:(_=(v=(r=d($))==null?void 0:r.siglas)==null?void 0:v.$errors[0])==null?void 0:_.$message},{default:u(()=>[o(m,{modelValue:t.value.siglas,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.siglas=n),icon:d(j)},null,8,["modelValue","icon"])]),_:1},8,["label","help"])],2),g("div",pe,[o(p,{label:a.$t("message.branch.country")},{default:u(()=>[o(m,{modelValue:t.value.pais,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.pais=n),icon:d(S),options:d(U),onOnSelectChange:O},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(p,{label:a.$t("message.branch.state")},{default:u(()=>[o(m,{modelValue:t.value.state,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.state=n),icon:d(S),options:d(h),onOnSelectChange:N},null,8,["modelValue","icon","options"])]),_:1},8,["label"])]),g("div",be,[o(p,{label:a.$t("message.branch.city")},{default:u(()=>[o(m,{modelValue:t.value.ciudad,"onUpdate:modelValue":e[5]||(e[5]=n=>t.value.ciudad=n),icon:d(S),options:d(V)},null,8,["modelValue","icon","options"])]),_:1},8,["label"]),o(p,{label:a.$t("message.branch.status"),help:(R=(f=(y=d($))==null?void 0:y.estado)==null?void 0:f.$errors[0])==null?void 0:R.$message},{default:u(()=>[o(m,{modelValue:t.value.estado,"onUpdate:modelValue":e[6]||(e[6]=n=>t.value.estado=n),icon:d(S),options:C},null,8,["modelValue","icon"])]),_:1},8,["label","help"])])])])]}),_:1},8,["onSubmit"]))}},Be=ne(ve,[["__scopeId","data-v-5ca537ea"]]);export{Be as F};
