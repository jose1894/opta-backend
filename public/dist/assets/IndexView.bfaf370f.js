import{u as ce,ak as me,r as g,U as pe,ax as ve,o as be,h as fe,i as s,a as n,A as ge,F as he,b as h,z as T,t as F,j as Ne,_ as v,p as m,B as Ve,ay as D,ar as E,aq as O,aL as $e}from"./index.2a5a620e.js";import{_ as ye,a as P}from"./BaseButton.cdd5c322.js";import{e as q,T as Pe}from"./enfoques.service.73989413.js";import{_ as b}from"./FormField.33193145.js";import{C as J}from"./CardBoxModal.bf388542.js";import{_ as qe}from"./SectionTitleLineWithButton.cea9389d.js";const _e={class:"grid md:grid-cols-2 gap-2"},Ie={class:"grid md:grid-cols-1 gap-1"},Se={class:"container mx-auto"},Ee={class:"grid md:grid-cols-4 gap-4 flex items-center"},Ue={__name:"IndexView",props:{path:"",saveLabel:"",state:{}},setup(L){const N=L,{t:r}=ce(),_=me(),U=g(!1),f=g(!1),z=!1,i=g({}),M=g(!1);let w="";const c=[{id:0,label:r("message.no")},{id:1,label:r("message.yes")}],V=[{id:0,label:r("message.list")},{id:1,label:r("message.menu")}],$=[{id:1,label:r("message.approach.statuses.active")},{id:0,label:r("message.approach.statuses.inactive")}],G={_id:"",indice:0,nombre:"",areaPadreNombre:"",rutaPadre:"",areaPadre:"",ruta:"",visible:V[0],rcr:c[0],editable:c[0],estado:$[0],tipoNodo:2},l=g(G),H=pe({selectedNodeId:null}),C=g(),k=(e,a=[])=>{e.map(o=>{const d=a.filter(t=>{var p;return((p=t==null?void 0:t.areaPadre)==null?void 0:p._id)===o._id});return d.length>0&&(o.children=d,k(d,a)),o})};ve(async()=>{j(),N.path==="update"&&console.log(N.path)});const j=async()=>{let e=await q.index();const{enfoques:a}=e,o=a.filter(t=>t.tipoNodo===0),d=a.filter(t=>t.tipoNodo!==0);k(o,d),o[0].collapsed=!0,C.value=o},K=N.path==="create"?r("message.approach.created.success"):r("message.approach.updated.success");N.path==="create"?r("message.approach.created.error"):r("message.approach.updated.error");const Q=async()=>{R(l).then(()=>{const e=B();Y(e),setTimeout(()=>{f.value=!1,_.success(K)},500)}).catch(e=>{var a,o,d,t;if(console.log(e),(o=(a=e.response)==null?void 0:a.data)!=null&&o.msg){_.error(`${r("message.approach.created.error")} ${e.response.data.msg}`);return}if((t=(d=e.response)==null?void 0:d.data)!=null&&t.errors){const p=e.response.data.errors;for(let y of p);}})},R=async e=>{e.value.tipoNodo=e.value.rutaPadre==="/"?1:2;const{_id:a,indice:o,nombre:d,areaPadre:t,areaPadreNombre:p,rutaPadre:y,ruta:u,visible:te,rcr:re,editable:de,estado:ne,tipoNodo:ie}=e.value,S={_id:a,indice:o,nombre:d,areaPadre:t,areaPadreNombre:p,rutaPadre:y,ruta:u,visible:te.id,rcr:re.id,editable:de.id,estado:ne.id,tipoNodo:ie};if(w==="create"){const ue=$e(S.fecha,"YYYY-MM-DD").format("YYYY-MM-DD");return S.fecha=ue,q.create(S)}return q.update(S)};r("message.approach.selectedNode");const W=()=>{if(w="create",Object.keys(i.value).length===0){U.value=!0;const e=Object.assign({},C.value[0]),a=Object.assign({},e);l.value=e,l.value.areaPadreNombre=e.nombre,l.value.nombre="",l.value.rutaPadre="/",l.value.areaPadre=e._id,l.value.estado=$.filter(o=>o.id===e.estado)[0],l.value.visible=V.filter(o=>o.id===e.visible)[0],l.value.rcr=c.filter(o=>o.id===e.rcr)[0],l.value.editable=c.filter(o=>o.id===e.editable)[0],l.value.tipoNodo=1,i.value=a,localStorage.setItem("itemEnfoque",JSON.stringify(i.value))}else A();f.value=!0},X=async()=>{w="update",l.value=i.value;const{visible:e,estado:a,rcr:o,editable:d,areaPadre:t,areaPadreNombre:p,rutaPadre:y}=i.value;if(console.log(i.value),t){l.value.areaPadre=typeof t=="object"?t._id:t,l.value.areaPadreNombre=typeof t=="object"?t.nombre:p;const u=typeof t=="object"?t.ruta:y;l.value.rutaPadre=u!==void 0?u:y}l.value.estado=$.filter(u=>u.id===I(a))[0],l.value.visible=V.filter(u=>u.id===I(e))[0],l.value.rcr=c.filter(u=>u.id===I(o))[0],l.value.editable=c.filter(u=>u.id===I(d))[0],f.value=!0},I=e=>typeof e=="object"?e.id:e,Y=async e=>{var a;if(U.value)j();else{e.children=[];const o=await q.getChildren(e._id),d=((a=o==null?void 0:o.data)==null?void 0:a.children)||[];e.children=d}},Z=e=>{i.value=e,localStorage.setItem("itemEnfoque",JSON.stringify(i.value)),A()},A=()=>{const e=B();l.value=e,l.value.areaPadre=e._id,l.value.areaPadreNombre=e.nombre,l.value.rutaPadre=e.ruta,N.path!=="update"&&(l.value._id="",l.value.indice=0,l.value.nombre="",l.value.estado=$.filter(a=>a.id===e.estado)[0],l.value.visible=V.filter(a=>a.id===e.visible)[0],l.value.rcr=c.filter(a=>a.id===e.rcr)[0],l.value.editable=c.filter(a=>a.id===e.editable)[0],l.value.tipoNodo=e.tipoNodo)},B=()=>{const e=localStorage.getItem("itemEnfoque");return JSON.parse(e)},x=e=>{Y(e),Z(e)},ee=()=>{const{nombre:e}=i.value;return e},ae=r("message.approach.deleted.success"),le=async()=>{oe().then(async()=>{j(),_.success(ae),i.value={},localStorage.setItem("itemEnfoque",JSON.stringify(i.value))}).catch(e=>{var a;_.error(`${r("message.approach.deleted.error")} ${(a=e==null?void 0:e.response)==null?void 0:a.data.msg}`)})},oe=()=>{const{_id:e}=i.value;return q.delete(e)},se=()=>f.value=!1;return(e,a)=>(be(),fe(he,null,[s(J,{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=o=>M.value=o),title:e.$t("message.pleaseConfirm"),button:"danger",onConfirm:le,"has-cancel":""},{default:n(()=>[h("strong",null,[T(F(e.$t("message.approach.deleted.question"))+" ",1),h("b",null,F(ee()),1)]),T(" ? ")]),_:1},8,["modelValue","title"]),s(J,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=o=>f.value=o),title:"Crear enfoque",hasDone:z,claseModal:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-8/12 xl:w-8/12 z-50"},{default:n(()=>[s(ye,{isForm:"",onSubmit:Ne(Q,["prevent"]),style:{height:"500px","overflow-y":"scroll","scroll-behavior":"smooth"}},{footer:n(()=>[s(P,{label:e.$t("message.submit"),type:"submit",color:"success"},null,8,["label"]),s(P,{label:e.$t("message.cancel"),color:"info",style:{"margin-left":"5px"},onClick:se},null,8,["label"])]),default:n(()=>[h("div",_e,[s(b,{label:e.$t("message.approach.indice")},{default:n(()=>[s(v,{name:"indice",modelValue:l.value.indice,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.indice=o),icon:m(D)},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(b,{label:e.$t("message.approach.name")},{default:n(()=>[s(v,{name:"name",modelValue:l.value.nombre,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.nombre=o),icon:m(D)},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(b,{label:e.$t("message.approach.parentArea")},{default:n(()=>[s(v,{name:"parentArea",modelValue:l.value.areaPadreNombre,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.areaPadreNombre=o),icon:m(D),readonly:!0},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(b,{label:e.$t("message.approach.visible")},{default:n(()=>[s(v,{modelValue:l.value.visible,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.visible=o),icon:m(E),options:V},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(b,{label:e.$t("message.approach.rcr")},{default:n(()=>[s(v,{modelValue:l.value.rcr,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.rcr=o),icon:m(E),options:c},null,8,["modelValue","icon"])]),_:1},8,["label"]),s(b,{label:e.$t("message.approach.editable")},{default:n(()=>[s(v,{modelValue:l.value.editable,"onUpdate:modelValue":a[6]||(a[6]=o=>l.value.editable=o),icon:m(E),options:c},null,8,["modelValue","icon"])]),_:1},8,["label"])]),h("div",Ie,[s(b,{label:e.$t("message.approach.status")},{default:n(()=>[s(v,{modelValue:l.value.estado,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.estado=o),icon:m(E),options:$},null,8,["modelValue","icon"])]),_:1},8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"]),s(ge,null,{default:n(()=>[s(Ve,null,{default:n(()=>[s(qe,{icon:e.mdiGlobeModel,title:e.$t("message.approach.approaches")},null,8,["icon","title"]),h("div",Se,[h("div",Ee,[s(P,{icon:m(O),label:e.$t("message.add_new"),color:"success",small:"",onClick:W},null,8,["icon","label"]),s(P,{icon:m(O),label:e.$t("message.edit"),color:"success",small:"",onClick:X},null,8,["icon","label"]),s(P,{icon:m(O),label:e.$t("message.delete"),color:"success",small:"",onClick:a[9]||(a[9]=o=>M.value=!0)},null,8,["icon","label"])])]),s(Pe,{nodes:C.value,selectedNodeId:H.selectedNodeId,onNodeSelected:x},null,8,["nodes","selectedNodeId"])]),_:1})]),_:1})],64))}};export{Ue as default};
